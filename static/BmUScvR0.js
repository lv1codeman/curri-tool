import{x as j,v as Y,b as t,s as A,ad as z,p as L,z as q,r as p,G as H,a as d,F as K,T as G,ae as Q,_ as X,af as Z,h as ee,l as N,w as s,o as m,m as O,d as g,t as y,c as w}from"#entry";import{V as ae}from"./WYaB8Wft.js";import{V as te}from"./CrRjTCCi.js";import{V as le,a as oe}from"./XGYclXl8.js";import{V as S,b as se,d as re,e as ue,a as ne}from"./Bt-Lg9Yq.js";import{V as h}from"./8GgSIkK4.js";import{V as ie}from"./IZXj_S-L.js";import{V as M,f as de,c as ce}from"./CeZwhVst.js";import{V as T,m as ve,a as me,b as fe}from"./BEHT4fO-.js";import{f as pe}from"./olVGSFH9.js";import{u as B}from"./BVTHWD1S.js";import{V as F}from"./CY2eiWj5.js";import{V as be}from"./C9RONKOs.js";import{V as Ve}from"./C8WRQOr-.js";import"./CcGyTVB8.js";import"./C1UajEuD.js";const ge=globalThis.setInterval,ye=Y({...ve({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),U=j()({name:"VRadio",props:ye(),setup(r,P){let{slots:_}=P;return B(()=>{const i=T.filterProps(r);return t(T,A(i,{class:["v-radio",r.class],style:r.style,type:"radio"}),_)}),{}}}),Ie=Y({height:{type:[Number,String],default:"auto"},...ce(),...Q(fe(),["multiple"]),trueIcon:{type:G,default:"$radioOn"},falseIcon:{type:G,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),Ee=j()({name:"VRadioGroup",inheritAttrs:!1,props:Ie(),emits:{"update:modelValue":r=>!0},setup(r,P){let{attrs:_,slots:i}=P;const I=z(),c=L(()=>r.id||`radio-group-${I}`),u=q(r,"modelValue"),n=p();return B(()=>{const[a,f]=H(_),E=M.filterProps(r),x=T.filterProps(r),b=i.label?i.label({label:r.label,props:{for:c.value}}):r.label;return t(M,A({ref:n,class:["v-radio-group",r.class],style:r.style},a,E,{modelValue:u.value,"onUpdate:modelValue":D=>u.value=D,id:c.value}),{...i,default:D=>{let{id:v,messagesId:k,isDisabled:C,isReadonly:V}=D;return d(K,null,[b&&t(de,{id:v.value},{default:()=>[b]}),t(me,A(x,{id:v.value,"aria-describedby":k.value,defaultsTarget:"VRadio",trueIcon:r.trueIcon,falseIcon:r.falseIcon,type:r.type,disabled:C.value,readonly:V.value,"aria-labelledby":b?v.value:void 0,multiple:!1},f,{modelValue:u.value,"onUpdate:modelValue":R=>u.value=R}),i)])}})}),pe({},n)}}),De={class:"d-flex justify-space-between align-center mb-2"},we={class:"d-flex justify-space-between align-center mb-4"},_e={class:"text-white font-weight-bold text-caption"},Ne={key:0},Oe={key:1},Pe={key:2},xe={key:3},Re={class:"custom-loader"},Le={key:0},ke={key:1},Ce=2e3,he={__name:"YTconverter",setup(r){const _=Z().public.apiBaseUrl,i=p(""),I=p("mp3"),c=p(""),u=p(""),n=p(null),a=p("IDLE"),f=p(0),E=p(null),{$curridataAPI:x}=ee(),b=L(function(){return a.value==="PENDING"||a.value==="DOWNLOADING"?"primary":a.value==="COMPLETED"?"success":a.value==="FAILED"||a.value==="ERROR"?"error":"grey"}),D=L(function(){return a.value==="PENDING"?"等待伺服器處理...":a.value==="DOWNLOADING"?`下載中... (${f.value.toFixed(1)}%)`:a.value==="COMPLETED"?"下載完成！":a.value==="FAILED"?"任務失敗！":a.value==="ERROR"?"連線/輪詢錯誤":"準備就緒"}),v=L(function(){return a.value==="PENDING"||a.value==="DOWNLOADING"}),k=async function(){if(c.value="",u.value="",V(),!i.value.trim()||!i.value.startsWith("http")){c.value="請輸入有效的 YouTube 網址，並確保它以 http 或 https 開頭。";return}a.value="PENDING",f.value=0,n.value=null,u.value="正在提交下載任務...";try{const l=JSON.stringify({url:i.value,format:I.value}),e=await x.post("submit_download_job",l),o=e.data;let $=o.job_id||o.id||o.taskId;if(!$)throw o.error||o.message?new Error(`伺服器回傳錯誤: ${o.error||o.message}`):new Error(`伺服器回傳格式錯誤，找不到 job_id、id 或 taskId。實際回傳資料：${JSON.stringify(e)}`);n.value=$,u.value=`任務已成功提交，Job ID: ${n.value}。開始追蹤進度...`,C()}catch(l){console.error("提交任務失敗:",l);let e=l.message||(typeof l=="object"&&l!==null?JSON.stringify(l):String(l));c.value=`提交任務失敗：${e}`,a.value="FAILED"}},C=function(){V(),R(),E.value=ge(R,Ce)},V=function(){E.value&&(clearInterval(E.value),E.value=null)},R=async function(){if(!n.value){V();return}try{const e=(await x.get(`download_status/${n.value}`)).data;if(!e.status)throw new Error("伺服器回傳狀態格式錯誤。");a.value=e.status,f.value=e.progress||0,a.value==="COMPLETED"?(V(),u.value="✅ 下載完成 (100%)！檔案已在伺服器準備完畢。正在啟動下載...",J()):a.value==="DOWNLOADING"?u.value=`下載中，進度更新至 ${f.value.toFixed(1)}%...`:a.value==="FAILED"&&(V(),c.value="❌ 任務處理失敗。請檢查網址或伺服器日誌。")}catch(l){console.error("輪詢錯誤:",l),V(),a.value="ERROR";let e=l.message||(typeof l=="object"&&l!==null?JSON.stringify(l):String(l));c.value=`輪詢狀態錯誤：${e}`}},J=function(){if(n.value&&a.value==="COMPLETED"){const l=`${_}/download_file/${n.value}`,e=document.createElement("a");e.href=l,e.setAttribute("download",`media_download_${n.value}.${I.value}`),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e),u.value="🎉 檔案下載已開始。瀏覽器將提示您儲存位置。",setTimeout(function(){a.value="IDLE",f.value=0,n.value=null},3e3)}},W=function(){(a.value==="IDLE"||a.value==="FAILED"||a.value==="ERROR")&&k()};return(l,e)=>(m(),N(ae,null,{default:s(()=>[t(te,{fluid:""},{default:s(()=>[t(le,{justify:"center",align:"start"},{default:s(()=>[t(oe,{cols:"12",sm:"10",md:"8",lg:"6",xl:"5"},{default:s(()=>[t(S,{class:"pa-4 pa-sm-8",elevation:"12",rounded:"xl"},{default:s(()=>[t(se,{class:"text-h4 text-sm-h3 text-center font-weight-bold mb-4"},{default:s(()=>[...e[5]||(e[5]=[g(" YouTube下載器 ",-1)])]),_:1}),t(re,{class:"text-center mb-6"},{default:s(()=>[...e[6]||(e[6]=[d("p",null,"輸入 YouTube 網址，選擇格式，伺服器將在背景處理任務。",-1),d("p",null,"例如：https://www.youtube.com/watch?v=JfYbYIv2-tY",-1)])]),_:1}),c.value?(m(),N(h,{key:0,type:"error",closable:"",icon:"mdi-alert-circle",variant:"tonal",class:"mb-4","onUpdate:modelValue":e[0]||(e[0]=o=>c.value="")},{default:s(()=>[e[7]||(e[7]=d("div",{class:"font-weight-medium"},"錯誤:",-1)),g(" "+y(c.value),1)]),_:1})):O("",!0),u.value&&a.value!=="COMPLETED"?(m(),N(h,{key:1,type:"info",icon:"mdi-information-outline",variant:"tonal",class:"mb-4"},{default:s(()=>[e[8]||(e[8]=d("div",{class:"font-weight-medium"},"狀態:",-1)),g(" "+y(u.value),1)]),_:1})):O("",!0),a.value==="COMPLETED"?(m(),N(h,{key:2,type:"success",icon:"mdi-check-all",variant:"tonal",class:"mb-4","onUpdate:modelValue":e[1]||(e[1]=o=>u.value="")},{default:s(()=>[e[9]||(e[9]=d("div",{class:"font-weight-medium"},"下載已完成!",-1)),g(" "+y(u.value),1)]),_:1})):O("",!0),t(ie,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=o=>i.value=o),label:"YouTube 影片網址",placeholder:"例如: https://www.youtube.com/watch?v=...",variant:"outlined",disabled:v.value,rules:[o=>!!o||"網址不能為空"],"prepend-inner-icon":"mdi-link-variant",clearable:"",class:"mb-6"},null,8,["modelValue","disabled","rules"]),t(Ee,{modelValue:I.value,"onUpdate:modelValue":e[3]||(e[3]=o=>I.value=o),label:"選擇輸出格式",inline:"",disabled:v.value,class:"mb-8"},{default:s(()=>[t(U,{label:"MP3 (音訊)",value:"mp3",color:"primary",icon:"mdi-music-box",class:"mr-4"}),t(U,{label:"MP4 (影片)",value:"mp4",color:"primary",icon:"mdi-video",class:"mr-4"})]),_:1},8,["modelValue","disabled"]),n.value?(m(),N(S,{key:3,loading:v.value,color:b.value,variant:"tonal",class:"mb-6 pa-4"},{default:s(()=>[d("div",De,[e[10]||(e[10]=d("span",{class:"text-subtitle-1 font-weight-medium"},"任務 ID:",-1)),t(F,{color:b.value,variant:"flat",size:"small"},{default:s(()=>[g(y(n.value),1)]),_:1},8,["color"])]),d("div",we,[e[11]||(e[11]=d("span",{class:"text-subtitle-1 font-weight-medium"},"目前狀態:",-1)),t(F,{color:b.value,variant:"outlined",size:"default"},{default:s(()=>[g(y(D.value),1)]),_:1},8,["color"])]),t(ue,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=o=>f.value=o),color:b.value,height:"16",rounded:"",striped:"",class:"my-2"},{default:s(({value:o})=>[d("span",_e,y(o.toFixed(1))+"% ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["loading","color"])):O("",!0),t(be,{onClick:W,loading:v.value,disabled:v.value,color:v.value?"primary":"success",size:"x-large",block:"",elevation:"8",rounded:"lg",class:"text-button"},{loader:s(()=>[d("span",Re,[t(Ve,{icon:"mdi-cached",class:"spin-icon"}),e[12]||(e[12]=g(" 處理中... ",-1))])]),default:s(()=>[a.value==="IDLE"||a.value==="FAILED"||a.value==="ERROR"?(m(),w("span",Ne,"開始下載")):a.value==="COMPLETED"?(m(),w("span",Oe,"下載完成 (點擊即可重新提交)")):a.value==="PENDING"?(m(),w("span",Pe,"提交中...")):a.value==="DOWNLOADING"?(m(),w("span",xe,y(D.value),1)):O("",!0)]),_:1},8,["loading","disabled","color"]),t(ne,{class:"text-caption text-center mt-6 text-grey-darken-1"},{default:s(()=>[e[13]||(e[13]=g(" **備註:** ",-1)),v.value?(m(),w("span",Le,"伺服器正在背景處理您的請求。請不要關閉頁面。")):(m(),w("span",ke,"下載時間取決於伺服器處理速度與檔案大小。"))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}},Ke=X(he,[["__scopeId","data-v-5ab031ce"]]);export{Ke as default};
