import{_ as O,l as f,o as c,w as a,b as t,p as N,d as m,t as P,e as J,h as K,r as s,q as W,f as X,c as Y,m as Z,F as ee,s as te,a as M,v as ae}from"#entry";import{a as q,V as le}from"./B-Hxcajx.js";import{b as H,V as T,a as R,c as oe}from"./CUuAJ6Ty.js";import{V as re}from"./D5rSoGI3.js";import{V as k,a as C}from"./DZIxpjna.js";import{V as S}from"./D8bvMAuO.js";import{V as L,a as z}from"./DnvMyz26.js";import{V as se}from"./BWZpj2fS.js";import{V as ne,a as ie}from"./BlKqekpN.js";import{V as ue}from"./n22iHS2n.js";import{V as de}from"./Caygb5uM.js";import"./BsiP8vYj.js";import"./BUz42rcT.js";import"./r6yzdEX_.js";import"./olVGSFH9.js";import"./I2Lz-SGT.js";import"./DNe2gOCb.js";import"./Dn88HoyX.js";import"./v4BGuXz-.js";import"./DkogjsBj.js";const ce={__name:"MemeCard",props:{title:String,imageUrl:String},emits:["copy","expand"],setup(v){return(g,n)=>(c(),f(T,{hover:"",class:"mx-auto h-100 transition-card"},{default:a(()=>[t(q,{src:v.imageUrl,height:"200px",cover:"",class:"align-end cursor-pointer",onClick:n[1]||(n[1]=N(p=>g.$emit("copy",{url:v.imageUrl,title:v.title}),["stop"]))},{default:a(()=>[t(H,{class:"text-white bg-black-alpha-50 cursor-pointer",onClick:n[0]||(n[0]=N(p=>g.$emit("expand"),["stop"]))},{default:a(()=>[m(P(v.title),1)]),_:1})]),_:1},8,["src"])]),_:1}))}},me=O(ce,[["__scopeId","data-v-a5c180cf"]]),pe={class:"text-h6 font-weight-bold"},fe=J({__name:"Meme",setup(v){const{$curridataAPI:g}=K(),n=s([]),p=s(""),U=s(!0),w=s(!1),y=s(!1),V=s(""),i=s(null),_=s(!1),D=s(""),F=s("success");async function j(){U.value=!0;try{const o=await g.get("/api/memes");n.value=o.data.map(e=>({...e,showPreview:!1}))}catch(o){console.error("無法取得梗圖列表:",o),u("❌ 無法連線至伺服器","error")}finally{U.value=!1}}async function Q(){if(!i.value||!V.value){u("請輸入名稱並選擇圖片","warning");return}y.value=!0;const o=new FormData,e=Array.isArray(i.value)?i.value[0]:i.value;o.append("file",e),o.append("title",V.value);try{await g.post("/api/upload-meme",o),u("✅ 梗圖上傳成功！","success"),B(),await j()}catch{u("❌ 上傳失敗","error")}finally{y.value=!1}}const A=W(()=>{if(!p.value)return n.value;const o=p.value.toLowerCase().trim().split(/\s+/);return n.value.filter(e=>{const d=e.title.toLowerCase();return o.every(l=>d.includes(l))})});async function G({url:o,title:e}){try{const d=o.replace("http://","https://")+`?t=${Date.now()}`,l=await fetch(d,{headers:{"ngrok-skip-browser-warning":"true"}});if(!l.ok)throw new Error("Fetch 失敗");const I=await l.blob(),r=new Image;r.crossOrigin="anonymous";const $=URL.createObjectURL(I);r.src=$,await new Promise((x,h)=>{r.onload=x,r.onerror=h});const b=document.createElement("canvas");b.width=r.width,b.height=r.height,b.getContext("2d")?.drawImage(r,0,0),b.toBlob(async x=>{if(x)try{const h=new ClipboardItem({"image/png":x});await navigator.clipboard.write([h]),u(`✅ 已複製 「${e}」`,"success")}catch{u("❌ 寫入剪貼簿失敗","error")}finally{URL.revokeObjectURL($)}},"image/png")}catch{u("❌ 複製失敗","error")}}function B(){w.value=!1,V.value="",i.value=null}function u(o,e="success"){D.value=o,F.value=e,_.value=!0}function E(o){return o?o.replace("http://","https://"):""}return X(j),(o,e)=>{const d=me;return c(),f(re,null,{default:a(()=>[t(k,{justify:"center",class:"mb-6"},{default:a(()=>[t(C,{cols:"12",md:"6",class:"d-flex align-center"},{default:a(()=>[t(S,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=l=>p.value=l),label:"搜尋梗圖關鍵字...","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"",class:"mr-4"},null,8,["modelValue"]),t(L,{color:"primary","prepend-icon":"mdi-upload",onClick:e[1]||(e[1]=l=>w.value=!0)},{default:a(()=>[...e[6]||(e[6]=[m(" 上傳梗圖 ",-1)])]),_:1})]),_:1})]),_:1}),U.value?(c(),f(k,{key:1,justify:"center"},{default:a(()=>[t(C,{cols:"12",class:"text-center py-12"},{default:a(()=>[t(z,{indeterminate:"",color:"primary",size:"50"}),e[9]||(e[9]=M("p",{class:"mt-4"},"梗圖載入中...",-1))]),_:1})]),_:1})):(c(),f(k,{key:0},{default:a(()=>[(c(!0),Y(ee,null,te(A.value,(l,I)=>(c(),f(C,{key:I,cols:"12",sm:"6",md:"4",lg:"3"},{default:a(()=>[t(se,{modelValue:l.showPreview,"onUpdate:modelValue":r=>l.showPreview=r,"close-on-content-click":!0,location:"center",transition:"scale-transition","min-width":"300"},{activator:a(({props:r})=>[t(d,ae({ref_for:!0},r,{title:l.title,"image-url":E(l.url),onCopy:G,onExpand:$=>l.showPreview=!0}),null,16,["title","image-url","onExpand"])]),default:a(()=>[t(T,{width:"500",elevation:"24",class:"rounded-xl overflow-hidden"},{default:a(()=>[t(q,{src:E(l.url),"max-height":"600",contain:"",class:"bg-grey-darken-4"},{placeholder:a(()=>[t(k,{class:"fill-height ma-0",align:"center",justify:"center"},{default:a(()=>[t(z,{indeterminate:"",color:"primary"})]),_:1})]),_:1},8,["src"]),t(R,{class:"bg-surface text-center py-4 border-t"},{default:a(()=>[M("div",pe,P(l.title),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024))),128)),A.value.length===0?(c(),f(C,{key:0,cols:"12",class:"text-center py-12"},{default:a(()=>[t(le,{size:"64",color:"grey-lighten-1"},{default:a(()=>[...e[7]||(e[7]=[m("mdi-image-search-outline",-1)])]),_:1}),e[8]||(e[8]=M("p",{class:"text-grey mt-2"},"找不到相關梗圖，換個關鍵字試試？",-1))]),_:1})):Z("",!0)]),_:1})),t(ne,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=l=>w.value=l),"max-width":"450px",persistent:""},{default:a(()=>[t(T,{class:"rounded-lg"},{default:a(()=>[t(H,{class:"bg-primary text-white px-6 py-4"},{default:a(()=>[...e[10]||(e[10]=[m("上傳新梗圖",-1)])]),_:1}),t(R,{class:"pt-8 px-6"},{default:a(()=>[t(S,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=l=>V.value=l),label:"梗圖描述與關鍵字",variant:"outlined",placeholder:"例如：驚訝貓咪 表情包",hint:"輸入愈詳細，之後搜尋愈容易找到喔！","persistent-hint":"",class:"mb-10"},null,8,["modelValue"]),t(ue,{modelValue:i.value,"onUpdate:modelValue":e[3]||(e[3]=l=>i.value=l),label:"選擇圖片檔案",accept:"image/*",variant:"outlined","prepend-icon":"mdi-camera","show-size":1024},null,8,["modelValue"])]),_:1}),t(oe,{class:"pa-6"},{default:a(()=>[t(ie),t(L,{variant:"text",onClick:B,disabled:y.value},{default:a(()=>[...e[11]||(e[11]=[m("取消",-1)])]),_:1},8,["disabled"]),t(L,{color:"primary",variant:"elevated",loading:y.value,onClick:Q},{default:a(()=>[...e[12]||(e[12]=[m("確認上傳",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(de,{modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=l=>_.value=l),color:F.value,location:"bottom right",timeout:"3000"},{default:a(()=>[m(P(D.value),1)]),_:1},8,["modelValue","color"])]),_:1})}}}),je=O(fe,[["__scopeId","data-v-9e4d0987"]]);export{je as default};
