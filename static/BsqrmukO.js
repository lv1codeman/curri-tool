import{_ as B,l as p,o as m,w as a,b as t,d,t as E,e as z,h as q,r as o,p as G,f as H,c as Q,m as J,F as K,q as W,a as j}from"#entry";import{a as X,V as Y}from"./CPAon7Lp.js";import{b as N,V as R,a as Z,c as ee}from"./Bdcr_zMt.js";import{V as te}from"./Dcrguy5K.js";import{V as T,a as k}from"./6CNKL-wN.js";import{V as A}from"./BXhrkaVQ.js";import{V as I,a as ae}from"./DbRMKfPm.js";import{V as le,a as re}from"./CiWdb9-2.js";import{V as oe}from"./SkXPSbHr.js";import{V as se}from"./D_0XGlGn.js";import"./DpNcNMXf.js";import"./D3wYNAQn.js";import"./4ObRCi9w.js";import"./olVGSFH9.js";import"./hfDzOCke.js";import"./BSAEodDF.js";import"./BD4OUTaE.js";import"./CqTIv2b6.js";import"./C7IzRcnk.js";const ne={__name:"MemeCard",props:{title:String,imageUrl:String},emits:["copy"],setup(f){return(y,c)=>(m(),p(R,{hover:"",class:"mx-auto cursor-pointer h-100",onClick:c[0]||(c[0]=v=>y.$emit("copy",{url:f.imageUrl,title:f.title}))},{default:a(()=>[t(X,{src:f.imageUrl,height:"200px",cover:"",class:"align-end"},{default:a(()=>[t(N,{class:"text-white bg-black-alpha-50"},{default:a(()=>[d(E(f.title),1)]),_:1})]),_:1},8,["src"])]),_:1}))}},ie=B(ne,[["__scopeId","data-v-1090fa0f"]]),ue=z({__name:"Meme",setup(f){const{$curridataAPI:y}=q(),c=o([]),v=o(""),U=o(!0),w=o(!1),b=o(!1),g=o(""),n=o(null),h=o(!1),L=o(""),$=o("success");async function D(){U.value=!0;try{const r=await y.get("/api/memes");c.value=r.data}catch(r){console.error("無法取得梗圖列表:",r),i("❌ 無法連線至伺服器，請檢查後端是否啟動","error")}finally{U.value=!1}}async function P(){if(!n.value||!g.value){i("請輸入名稱並選擇圖片","warning");return}b.value=!0;const r=new FormData,e=Array.isArray(n.value)?n.value[0]:n.value;r.append("file",e),r.append("title",g.value);try{await y.post("/api/upload-meme",r,{headers:{"Content-Type":"multipart/form-data"}}),i("✅ 梗圖上傳成功！","success"),F(),await D()}catch(s){console.error("上傳失敗:",s),i("❌ 上傳失敗，請稍後再試","error")}finally{b.value=!1}}const M=G(()=>{if(!v.value)return c.value;const r=v.value.toLowerCase().trim().split(/\s+/);return c.value.filter(e=>{const s=e.title.toLowerCase();return r.every(l=>s.includes(l))})});async function O({url:r,title:e}){try{const s=r.replace("http://","https://")+`?t=${Date.now()}`,l=await fetch(s,{method:"GET",mode:"cors",headers:{"ngrok-skip-browser-warning":"true"}});if(!l.ok)throw new Error(`HTTP 錯誤: ${l.status}`);const _=await l.blob(),u=new Image;u.crossOrigin="anonymous";const S=URL.createObjectURL(_);u.src=S,await new Promise((x,V)=>{u.onload=x,u.onerror=()=>V(new Error("Canvas 渲染失敗"))});const C=document.createElement("canvas");C.width=u.width,C.height=u.height,C.getContext("2d")?.drawImage(u,0,0),C.toBlob(async x=>{if(x)try{const V=new ClipboardItem({"image/png":x});await navigator.clipboard.write([V]),i(`✅ 已複製 「${e}」`,"success")}catch(V){console.error("剪貼簿寫入錯誤:",V),i("❌ 寫入剪貼簿失敗","error")}finally{URL.revokeObjectURL(S)}},"image/png")}catch(s){console.error("複製完整錯誤細節:",s),i("❌ 權限不足或 Server 設定錯誤","error")}}function F(){w.value=!1,g.value="",n.value=null}function i(r,e="success"){L.value=r,$.value=e,h.value=!0}return H(()=>{D()}),(r,e)=>{const s=ie;return m(),p(te,null,{default:a(()=>[t(T,{justify:"center",class:"mb-6"},{default:a(()=>[t(k,{cols:"12",md:"6",class:"d-flex align-center"},{default:a(()=>[t(A,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=l=>v.value=l),label:"搜尋梗圖關鍵字...","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"",class:"mr-4"},null,8,["modelValue"]),t(I,{color:"primary","prepend-icon":"mdi-upload",onClick:e[1]||(e[1]=l=>w.value=!0)},{default:a(()=>[...e[6]||(e[6]=[d(" 上傳梗圖 ",-1)])]),_:1})]),_:1})]),_:1}),U.value?(m(),p(T,{key:1,justify:"center"},{default:a(()=>[t(k,{cols:"12",class:"text-center py-12"},{default:a(()=>[t(ae,{indeterminate:"",color:"primary"}),e[9]||(e[9]=j("p",{class:"mt-4"},"梗圖載入中...",-1))]),_:1})]),_:1})):(m(),p(T,{key:0},{default:a(()=>[(m(!0),Q(K,null,W(M.value,(l,_)=>(m(),p(k,{key:_,cols:"12",sm:"6",md:"4",lg:"3"},{default:a(()=>[t(s,{title:l.title,"image-url":l.url,onCopy:O},null,8,["title","image-url"])]),_:2},1024))),128)),M.value.length===0?(m(),p(k,{key:0,cols:"12",class:"text-center py-12"},{default:a(()=>[t(Y,{size:"64",color:"grey-lighten-1"},{default:a(()=>[...e[7]||(e[7]=[d("mdi-image-search-outline",-1)])]),_:1}),e[8]||(e[8]=j("p",{class:"text-grey mt-2"},"找不到相關梗圖，換個關鍵字試試？",-1))]),_:1})):J("",!0)]),_:1})),t(le,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=l=>w.value=l),"max-width":"450px",persistent:""},{default:a(()=>[t(R,null,{default:a(()=>[t(N,{class:"bg-primary text-white"},{default:a(()=>[...e[10]||(e[10]=[d("上傳新梗圖",-1)])]),_:1}),t(Z,{class:"pt-4"},{default:a(()=>[t(A,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=l=>g.value=l),label:"梗圖描述與關鍵字",variant:"outlined",placeholder:"例如：熊貓驚訝 表情包 嚇死我了",hint:"輸入愈詳細，之後搜尋愈容易找到喔！","persistent-hint":"",class:"mb-4"},null,8,["modelValue"]),t(oe,{modelValue:n.value,"onUpdate:modelValue":e[3]||(e[3]=l=>n.value=l),label:"選擇圖片檔案",accept:"image/*",variant:"outlined","prepend-icon":"mdi-camera","show-size":1024},null,8,["modelValue"])]),_:1}),t(ee,null,{default:a(()=>[t(re),t(I,{variant:"text",onClick:F,disabled:b.value},{default:a(()=>[...e[11]||(e[11]=[d("取消",-1)])]),_:1},8,["disabled"]),t(I,{color:"primary",variant:"elevated",loading:b.value,onClick:P},{default:a(()=>[...e[12]||(e[12]=[d("確認上傳",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(se,{modelValue:h.value,"onUpdate:modelValue":e[5]||(e[5]=l=>h.value=l),color:$.value,location:"bottom right",timeout:"3000"},{default:a(()=>[d(E(L.value),1)]),_:1},8,["modelValue","color"])]),_:1})}}}),Le=B(ue,[["__scopeId","data-v-22670059"]]);export{Le as default};
