import{p as H,q as F,s as ge,v as he,x as be,y as K,z as _,r as b,A as we,B as Ve,C as Ce,D as ke,b as c,E,a as D,F as $,n as Fe,G as De,H as Ae,_ as Ie,h as xe,f as Se,c as Te,w as y,o as Be,d as V,t as $e}from"#entry";import{V as ze,b as L,c as Pe,a as Re,d as B,e as Ue}from"./4Td1EdPI.js";import{V as Ee}from"./BrdOxEFr.js";import{V as Le}from"./UQLOMqUI.js";import{V as Me}from"./KYABtfDM.js";import{u as Ne,V as W,a as q,m as je,b as Oe,c as Ge}from"./DifO3NxO.js";import{f as _e}from"./olVGSFH9.js";import{V as We}from"./eXhokCXr.js";import{u as qe}from"./7kqxRFU_.js";import"./un5phzSR.js";import"./B3Ie5AgL.js";import"./Bj8GeUNe.js";import"./Dziq4udP.js";import"./D20qIuBp.js";import"./DwU9_ecP.js";import"./CkvUrmgQ.js";import"./5HE8DmgL.js";import"./B19g07ev.js";import"./CgPuvXI5.js";function He(){function e(n){return[...n.dataTransfer?.items??[]].filter(i=>i.kind==="file").map(i=>i.webkitGetAsEntry()).filter(Boolean).length>0||[...n.dataTransfer?.files??[]].length>0}async function r(n){const o=[],i=[...n.dataTransfer?.items??[]].filter(a=>a.kind==="file").map(a=>a.webkitGetAsEntry()).filter(Boolean);if(i.length)for(const a of i){const h=await J(a,Q(".",a));o.push(...h.map(s=>s.file))}else o.push(...n.dataTransfer?.files??[]);return o}return{handleDrop:r,hasFilesOrFolders:e}}function J(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new Promise((n,o)=>{e.isFile?e.file(a=>n([{file:a,path:r}]),o):e.isDirectory&&e.createReader().readEntries(async a=>{const h=[];for(const s of a)h.push(...await J(s,Q(r,s)));n(h)})})}function Q(e,r){return r.isDirectory?`${e}/${r.name}`:e}const Ke=H({filterByType:String},"file-accept");function Je(e){const r=F(()=>e.filterByType?Qe(e.filterByType):null);function n(o){if(r.value){const i=o.filter(r.value);return{accepted:i,rejected:o.filter(a=>!i.includes(a))}}return{accepted:o,rejected:[]}}return{filterAccepted:n}}function Qe(e){const r=e.split(",").map(a=>a.trim().toLowerCase()),n=r.filter(a=>a.startsWith(".")),o=r.filter(a=>a.endsWith("/*")),i=r.filter(a=>!n.includes(a)&&!o.includes(a));return a=>{const h=a.name.split(".").at(-1)?.toLowerCase()??"",s=a.type.split("/").at(0)?.toLowerCase()??"";return i.includes(a.type)||n.includes(`.${h}`)||o.includes(`${s}/*`)}}const Xe=H({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},truncateLength:{type:[Number,String],default:22},...Oe({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>K(e).every(r=>r!=null&&typeof r=="object")},...Ke(),...je({clearable:!0})},"VFileInput"),Ye=ge()({name:"VFileInput",inheritAttrs:!1,props:Xe(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0,rejected:e=>!0},setup(e,r){let{attrs:n,emit:o,slots:i}=r;const{t:a}=he(),{filterAccepted:h}=Je(e),s=be(e,"modelValue",e.modelValue,t=>K(t),t=>!e.multiple&&Array.isArray(t)?t[0]:t),{isFocused:v,focus:w,blur:A}=Ne(e),x=F(()=>typeof e.showSize!="boolean"?e.showSize:void 0),S=F(()=>(s.value??[]).reduce((t,p)=>{let{size:C=0}=p;return t+C},0)),g=F(()=>_(S.value,x.value)),d=F(()=>(s.value??[]).map(t=>{const{name:p="",size:C=0}=t,k=ne(p);return e.showSize?`${k} (${_(C,x.value)})`:k})),l=F(()=>{const t=s.value?.length??0;return e.showSize?a(e.counterSizeString,t,g.value):a(e.counterString,t)}),u=b(),f=b(),m=b(),X=we(()=>v.value||e.active),M=F(()=>["plain","underlined"].includes(e.variant)),T=Ve(!1),{handleDrop:Y,hasFilesOrFolders:Z}=He();function z(){m.value!==document.activeElement&&m.value?.focus(),v.value||w()}function ee(t){m.value?.click()}function te(t){o("mousedown:control",t)}function le(t){m.value?.click(),o("click:control",t)}function ae(t){t.stopPropagation(),z(),De(()=>{s.value=[],Ae(e["onClick:clear"],t)})}function ne(t){if(t.length<Number(e.truncateLength))return t;const p=Math.floor((Number(e.truncateLength)-1)/2);return`${t.slice(0,p)}â€¦${t.slice(t.length-p)}`}function ie(t){t.preventDefault(),t.stopImmediatePropagation(),T.value=!0}function oe(t){t.preventDefault(),T.value=!1}async function se(t){if(t.preventDefault(),t.stopImmediatePropagation(),T.value=!1,!m.value||!Z(t))return;const p=await Y(t);N(p)}function re(t){if(!(!t.target||t.repack))if(e.filterByType)N([...t.target.files]);else{const p=t.target;s.value=[...p.files??[]]}}function N(t){const p=new DataTransfer,{accepted:C,rejected:k}=h(t);k.length&&o("rejected",k);for(const R of C)p.items.add(R);m.value.files=p.files,s.value=[...p.files];const P=new Event("change",{bubbles:!0});P.repack=!0,m.value.dispatchEvent(P)}return Ce(s,t=>{(!Array.isArray(t)||!t.length)&&m.value&&(m.value.value="")}),qe(()=>{const t=!!(i.counter||e.counter),p=!!(t||i.details),[C,k]=ke(n),{modelValue:P,...R}=W.filterProps(e),ue={...q.filterProps(e),"onClick:clear":ae},ce=n.webkitdirectory!==void 0&&n.webkitdirectory!==!1?void 0:e.filterByType??String(n.accept);return c(W,E({ref:u,modelValue:e.multiple?s.value:s.value[0],class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--dragging":T.value,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":M.value},e.class],style:e.style,"onClick:prepend":ee},C,R,{centerAffix:!M.value,focused:v.value}),{...i,default:U=>{let{id:de,isDisabled:j,isDirty:O,isReadonly:G,isValid:fe,hasDetails:pe}=U;return c(q,E({ref:f,prependIcon:e.prependIcon,onMousedown:te,onClick:le,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},ue,{id:de.value,active:X.value||O.value,dirty:O.value||e.dirty,disabled:j.value,focused:v.value,details:pe.value,error:fe.value===!1,onDragover:ie,onDrop:se}),{...i,default:ve=>{let{props:{class:me,...ye}}=ve;return D($,null,[D("input",E({ref:m,type:"file",accept:ce,readonly:G.value,disabled:j.value,multiple:e.multiple,name:e.name,onClick:I=>{I.stopPropagation(),G.value&&I.preventDefault(),z()},onChange:re,onDragleave:oe,onFocus:z,onBlur:A},ye,k),null),D("div",{class:Fe(me)},[!!s.value?.length&&!e.hideInput&&(i.selection?i.selection({fileNames:d.value,totalBytes:S.value,totalBytesReadable:g.value}):e.chips?d.value.map(I=>c(We,{key:I,size:"small",text:I},null)):d.value.join(", "))])])}})},details:p?U=>D($,null,[i.details?.(U),t&&D($,null,[D("span",null,null),c(Ge,{active:!!s.value?.length,value:l.value,disabled:e.disabled},i.counter)])]):void 0})}),_e({},u,f,m)}}),Ze="/api/upload-save",et={__name:"Upload",setup(e){const{$curridataAPI:r}=xe(),n=b(null),o=b(!1),i=b(!1),a=b(""),h=b("success"),s=b([]),v=b(null),w=b(!1);async function A(){w.value=!0,s.value=[],v.value=null;try{let l=(await r.get("/api/list-saves")).data.files||[];const u=l.filter(f=>f.includes("."));if(s.value=u,s.value.length===0)g("ä¼ºæœå™¨å­˜æª”ç›®éŒ„ä¸­æ²’æœ‰å¯ä¾›ä¸‹è¼‰çš„æª”æ¡ˆã€‚","info");else if(l.length!==u.length){const f=l.length-u.length;g(`å·²æˆåŠŸæŽ’é™¤ ${f} å€‹è³‡æ–™å¤¾ï¼Œåƒ…é¡¯ç¤ºæª”æ¡ˆã€‚`,"success")}else g(`âœ… æˆåŠŸè¼‰å…¥ ${s.value.length} å€‹æª”æ¡ˆã€‚`,"success")}catch(d){console.error("ç²å–æª”æ¡ˆåˆ—è¡¨å¤±æ•—:",d),g("âŒ ç„¡æ³•è¼‰å…¥å­˜æª”åˆ—è¡¨ã€‚","error")}finally{w.value=!1}}function x(){if(!v.value)return;const d=r.defaults.baseURL||window.location.origin,l=encodeURIComponent(v.value),u=`${d}/api/download-save/${l}`,f=document.createElement("a");f.href=u,f.setAttribute("download",v.value),document.body.appendChild(f),f.click(),document.body.removeChild(f),g(`ðŸ“¥ æ­£åœ¨ä¸‹è¼‰ï¼š${v.value} (ä¸‹è¼‰å°‡åœ¨ç€è¦½å™¨ä¸­é–‹å§‹)`,"info"),v.value=null}Se(A);async function S(){if(!n.value){g("è«‹å…ˆé¸æ“‡ä¸€å€‹æª”æ¡ˆï¼","warning");return}o.value=!0;let d=null;if(Array.isArray(n.value)&&n.value.length>0?d=n.value[0]:n.value instanceof File&&(d=n.value),!d||!(d instanceof File)){g("æª”æ¡ˆç‰©ä»¶ç„¡æ•ˆï¼è«‹é‡æ–°é¸æ“‡ã€‚","error"),o.value=!1;return}const l=new FormData;l.append("file",d);try{const f=(await r.post(Ze,l,{timeout:12e4,headers:{"Content-Type":void 0}})).data;g(`âœ… ${f.message}`,"success"),A()}catch(u){const f=u.response?.data?.detail||u.message||"æœªçŸ¥éŒ¯èª¤";let m=`âŒ ä¸Šå‚³å¤±æ•—ï¼š${f}`;Array.isArray(f)&&(m="âŒ ä¸Šå‚³å¤±æ•—ï¼šä¼ºæœå™¨é©—è­‰éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥æª”æ¡ˆæ ¼å¼ã€‚"),console.error("ä¸Šå‚³å¤±æ•—çš„éŒ¯èª¤ç‰©ä»¶:",u),g(m,"error")}finally{o.value=!1,n.value=null}}function g(d,l){a.value=d,h.value=l,i.value=!0}return(d,l)=>(Be(),Te($,null,[c(ze,{class:"mx-auto pa-4","max-width":"600",elevation:"10"},{default:y(()=>[c(L,{class:"text-h5 mb-2"},{default:y(()=>[...l[4]||(l[4]=[V("ðŸ’¾ Minecraft å­˜æª”ç®¡ç†",-1)])]),_:1}),c(Pe,null,{default:y(()=>[...l[5]||(l[5]=[V("ç›®æ¨™ç›®éŒ„ï¼šC:\\Users\\admin\\...\\saves",-1)])]),_:1}),c(Re,null,{default:y(()=>[c(L,{class:"text-h6 mb-2 mt-4 pa-0"},{default:y(()=>[...l[6]||(l[6]=[V("ðŸ“¥ ä¸‹è¼‰ä¼ºæœå™¨å­˜æª”",-1)])]),_:1}),c(Le,{modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=u=>v.value=u),items:s.value,label:"é¸æ“‡è¦ä¸‹è¼‰çš„å­˜æª”æª”æ¡ˆ (åŒ…å«å‰¯æª”å)",hint:"é»žæ“Šå³å´æŒ‰éˆ•é‡æ–°æ•´ç†æ¸…å–®","persistent-hint":"",variant:"outlined",density:"compact",clearable:"",loading:w.value,disabled:w.value,"item-title":"title","item-value":"value"},{"append-inner":y(()=>[c(B,{icon:"mdi-refresh",variant:"text",size:"small",onClick:A,loading:w.value,disabled:w.value},null,8,["loading","disabled"])]),_:1},8,["modelValue","items","loading","disabled"]),c(Me,{class:"my-4"}),c(L,{class:"text-h6 mb-2 pa-0"},{default:y(()=>[...l[7]||(l[7]=[V("â¬†ï¸ ä¸Šå‚³æ–°å­˜æª”",-1)])]),_:1}),c(Ye,{modelValue:n.value,"onUpdate:modelValue":l[1]||(l[1]=u=>n.value=u),label:"æ‹–æ›³æˆ–é»žæ“Šé¸æ“‡å­˜æª”æª”æ¡ˆ (.zip, è³‡æ–™å¤¾, .dat ç­‰)",hint:"åŒåæª”æ¡ˆå°‡åœ¨ä¼ºæœå™¨ç«¯è¢«è¦†è“‹","persistent-hint":"",variant:"outlined",density:"compact","prepend-icon":"mdi-cloud-upload","show-size":!0,counter:"",chips:"",clearable:"",disabled:o.value},null,8,["modelValue","disabled"])]),_:1}),c(Ue,{class:"d-flex justify-space-between"},{default:y(()=>[c(B,{color:"secondary",disabled:!v.value,onClick:x,"prepend-icon":"mdi-download",size:"large",variant:"tonal"},{default:y(()=>[...l[8]||(l[8]=[V(" ä¸‹è¼‰é¸å®šå­˜æª” ",-1)])]),_:1},8,["disabled"]),c(B,{color:"primary",disabled:!n.value||o.value,loading:o.value,onClick:S,"append-icon":"mdi-content-save",size:"large"},{default:y(()=>[...l[9]||(l[9]=[V(" ä¸Šå‚³ä¸¦å„²å­˜å­˜æª” ",-1)])]),_:1},8,["disabled","loading"])]),_:1})]),_:1}),c(Ee,{modelValue:i.value,"onUpdate:modelValue":l[3]||(l[3]=u=>i.value=u),timeout:3e3,color:h.value,location:"bottom right"},{actions:y(()=>[c(B,{color:"white",variant:"text",onClick:l[2]||(l[2]=u=>i.value=!1)},{default:y(()=>[...l[10]||(l[10]=[V(" é—œé–‰ ",-1)])]),_:1})]),default:y(()=>[V($e(a.value)+" ",1)]),_:1},8,["modelValue","color"])],64))}},Vt=Ie(et,[["__scopeId","data-v-9ae101dc"]]);export{Vt as default};
