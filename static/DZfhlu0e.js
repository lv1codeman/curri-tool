import{_ as F}from"./C2MaPLO4.js";import{y as j,x as q,A as K,ad as R,D as P,r as g,q as x,v as V,b as t,ae as Y,e as G,h as J,f as W,l as v,o as m,w as a,m as T,a as A,d as u,c as B,F as H,t as D,n as Q,aB as X,aC as N,aD as O,aE as Z,_ as h}from"#entry";import{V as ee,a as te,b as ae}from"./zypiqMLg.js";import{a as oe,V as le}from"./DkD3ALYe.js";import{V as k}from"./CCfnJY9-.js";import{V as re,b as _}from"./Bcb1to0P.js";import{V as n}from"./rH3DN2X2.js";import{a as U,m as ie}from"./CckPHoA0.js";import{f as ne}from"./olVGSFH9.js";import{u as se}from"./BElQ_p6l.js";import{u as ue}from"./B1Ixl-qY.js";import{V as $}from"./_dCvhc8Z.js";import{V as de}from"./DMhQui8H.js";import{V as L,b as M,a as z,c as me}from"./YR7iq5u-.js";import{V as ce}from"./BSSIIZGv.js";import{V as pe}from"./DqmtHXi9.js";import{V as E}from"./f_4U8FIS.js";import{V as fe}from"./DoEmiyRR.js";import"./Dznn0UcC.js";import"./6iByGTLO.js";import"./FwCbBb-r.js";import"./BCnkYaPz.js";import"./B5C3jfot.js";import"./Ca5UShn9.js";const ve=q({id:String,interactive:Boolean,text:String,...Y(ie({closeOnBack:!1,location:"end",locationStrategy:"connected",eager:!0,minWidth:0,offset:10,openOnClick:!1,openOnHover:!0,origin:"auto",scrim:!1,scrollStrategy:"reposition",stickToTarget:!0,transition:null}),["absolute","persistent"])},"VTooltip"),ge=j()({name:"VTooltip",props:ve(),emits:{"update:modelValue":l=>!0},setup(l,C){let{slots:i}=C;const d=K(l,"modelValue"),{scopeId:f}=se(),p=R(),c=P(()=>l.id||`v-tooltip-${p}`),s=g(),y=x(()=>l.location.split(" ").length>1?l.location:l.location+" center"),w=x(()=>l.origin==="auto"||l.origin==="overlap"||l.origin.split(" ").length>1||l.location.split(" ").length>1?l.origin:l.origin+" center"),b=P(()=>l.transition!=null?l.transition:d.value?"scale-transition":"fade-transition"),I=x(()=>V({"aria-describedby":c.value},l.activatorProps));return ue(()=>{const r=U.filterProps(l);return t(U,V({ref:s,class:["v-tooltip",{"v-tooltip--interactive":l.interactive},l.class],style:l.style,id:c.value},r,{modelValue:d.value,"onUpdate:modelValue":e=>d.value=e,transition:b.value,absolute:!0,location:y.value,origin:w.value,persistent:!0,role:"tooltip",activatorProps:I.value,_disableGlobalStack:!0},f),{activator:i.activator,default:function(){for(var e=arguments.length,S=new Array(e),o=0;o<e;o++)S[o]=arguments[o];return i.default?.(...S)??l.text}})}),ne({},s)}}),Ve={class:"d-flex align-center pr-4"},ye={key:0},xe={class:"mr-3 text-subtitle-1 font-weight-bold"},be={key:1},ke=G({__name:"layout1",setup(l){const{$curridataAPI:C}=J(),i=g(null),d=g(!1),f=g(""),p=g(""),c=g(!1),s=g(""),y=x(()=>!!i.value),w=x(()=>i.value&&i.value.auth==="admin");x(()=>i.value&&i.value.auth==="curri"),W(()=>{if(typeof localStorage<"u"){const r=localStorage.getItem("curridata_user");if(r)try{i.value=JSON.parse(r)}catch(e){console.error("解析 localStorage 使用者狀態失敗:",e),localStorage.removeItem("curridata_user")}}});async function b(){if(!f.value||!p.value){s.value="請輸入完整的帳號和密碼。";return}c.value=!0,s.value="";try{const r=await C.post("/api/user_login",{username:f.value,password:p.value}),e={name:r.data.user.name,auth:r.data.user.auth,username:r.data.user.username};i.value=e,d.value=!1,typeof localStorage<"u"&&localStorage.setItem("curridata_user",JSON.stringify(e)),p.value="",O("/welcome",{replace:!0})}catch(r){if(Z.isAxiosError(r)){const e=r.response?.status;e===401?s.value=r.response?.data?.detail||"帳號或密碼錯誤，請重新輸入。":r.response?s.value=`伺服器回應異常 (${e})，請稍後再試。`:s.value="無法連線至伺服器，請檢查網路連線。",console.error("Axios 登入錯誤:",r.response?.data||r.message)}else console.error("非 API 錯誤:",r),s.value="系統發生未知錯誤。";i.value=null,typeof localStorage<"u"&&localStorage.removeItem("curridata_user")}finally{c.value=!1}}function I(){i.value=null,typeof localStorage<"u"&&localStorage.removeItem("curridata_user"),alert("您已登出。"),O("/",{replace:!0})}return(r,e)=>{const S=F;return m(),v(fe,null,{default:a(()=>[t(ee,{app:""},{default:a(()=>[t(S,{to:"/"},{default:a(()=>[t(te,{class:"pl-4"},{default:a(()=>[...e[6]||(e[6]=[u("課務輔助工具",-1)])]),_:1})]),_:1}),t(oe),A("div",Ve,[y.value?(m(),B(H,{key:0},[i.value?(m(),B("div",ye,[A("span",xe," 歡迎，"+D(i.value.name)+" ("+D(i.value.username)+") ",1)])):(m(),B("div",be,[...e[7]||(e[7]=[A("span",null,"請先登入",-1)])])),t(k,{"prepend-icon":"mdi-logout",color:"error",variant:"flat",onClick:I,size:"large"},{default:a(()=>[...e[8]||(e[8]=[u(" 登出 ",-1)])]),_:1})],64)):(m(),v(k,{key:1,"prepend-icon":"mdi-login",color:"primary",variant:"flat",onClick:e[0]||(e[0]=o=>d.value=!0),size:"large"},{default:a(()=>[...e[9]||(e[9]=[u(" 登入系統 ",-1)])]),_:1}))])]),_:1}),y.value?(m(),v(ae,{key:0,"expand-on-hover":"",permanent:"",rail:"",app:""},{default:a(()=>[t(re,{nav:""},{default:a(()=>[t(n,{title:"公告消息",link:"",to:"/welcome","prepend-icon":"mdi-home-outline"}),t(n,{title:"資訊速查",link:"",to:"/Info/Info","prepend-icon":"mdi-information"}),t(_,{value:"database_maintenance"},{activator:a(({props:o})=>[t(n,V(o,{"prepend-icon":"mdi-database-cog",title:"資料庫維護"}),null,16)]),default:a(()=>[t(n,{title:"系所表維護",link:"",to:"/DB/DBmaintain","prepend-icon":"mdi-table-edit"}),t(ge,{text:"班級-系所簡稱對照表維護",location:"end"},{activator:a(({props:o})=>[t(n,V(o,{title:"班級-系所簡稱對照表維護",link:"",to:"/DB/ClassDeptshort","prepend-icon":"mdi-compare-horizontal"}),null,16)]),_:1}),t(n,{title:"課務承辦維護",link:"",to:"/DB/CurriAgent","prepend-icon":"mdi-account-edit"})]),_:1}),t(_,{value:"curriculum_tools"},{activator:a(({props:o})=>[t(n,V(o,{"prepend-icon":"mdi-toolbox",title:"課務工具"}),null,16)]),default:a(()=>[t(n,{title:"班級簡稱轉換",link:"",to:"/Converters/ClassToOthers","prepend-icon":"mdi-file-swap"}),t(n,{title:"學制轉換",link:"",to:"/Converters/SIDtoSYS","prepend-icon":"mdi-file-swap"})]),_:1}),t(_,{value:"tools"},{activator:a(({props:o})=>[t(n,V(o,{"prepend-icon":"mdi-tools",title:"其他工具"}),null,16)]),default:a(()=>[t(n,{title:"梗圖搜尋",link:"",to:"/Tools/Meme","prepend-icon":"mdi-image"}),t(n,{title:"Youtube影片下載",link:"",to:"/Tools/YTconverter","prepend-icon":"mdi-download-box"})]),_:1}),w.value?(m(),v(_,{key:0,value:"sixer"},{activator:a(({props:o})=>[t(n,V(o,{"prepend-icon":"mdi-star-circle-outline",title:"Sixer"}),null,16)]),default:a(()=>[t(n,{title:"Minecraft",link:"",to:"/Sixer/Minecraft","prepend-icon":"mdi-download-box"}),t(n,{title:"存檔更新",link:"",to:"/Sixer/Upload","prepend-icon":"mdi-download-box"})]),_:1})):T("",!0)]),_:1})]),_:1})):T("",!0),y.value?(m(),v($,{key:1,class:Q(["d-flex justify-center mt-2",{"ml-0":!y.value}])},{default:a(()=>[t(de,null,{default:a(()=>[X(r.$slots,"default",{},void 0,!0)]),_:3})]),_:3},8,["class"])):(m(),v($,{key:2,class:"d-flex align-center justify-center"},{default:a(()=>[t(L,{class:"text-center pa-10",elevation:"5","max-width":"500"},{default:a(()=>[t(ce,{color:"warning",size:"60",class:"mb-4"},{default:a(()=>[...e[10]||(e[10]=[u("mdi-lock-alert",-1)])]),_:1}),t(M,{class:"text-h5"},{default:a(()=>[...e[11]||(e[11]=[u("需要登入",-1)])]),_:1}),t(z,{class:"text-subtitle-1"},{default:a(()=>[...e[12]||(e[12]=[u(" 請點擊右上角「登入系統」以存取課務輔助工具。 ",-1)])]),_:1}),t(k,{color:"primary",variant:"flat",class:"mt-4",onClick:e[1]||(e[1]=o=>d.value=!0)},{default:a(()=>[...e[13]||(e[13]=[u(" 前往登入 ",-1)])]),_:1})]),_:1})]),_:1})),t(le,{modelValue:d.value,"onUpdate:modelValue":e[5]||(e[5]=o=>d.value=o),"max-width":"400"},{default:a(()=>[t(L,null,{default:a(()=>[t(M,{class:"text-h5 primary lighten-2"},{default:a(()=>[...e[14]||(e[14]=[u(" 使用者登入 ",-1)])]),_:1}),t(z,{class:"pt-4"},{default:a(()=>[s.value?(m(),v(pe,{key:0,type:"error",density:"compact",class:"mb-3"},{default:a(()=>[u(D(s.value),1)]),_:1})):T("",!0),t(E,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=o=>f.value=o),label:"帳號 (ACCOUNT)","prepend-inner-icon":"mdi-account",variant:"outlined",density:"compact",disabled:c.value,required:"",onKeyup:N(b,["enter"])},null,8,["modelValue","disabled"]),t(E,{modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=o=>p.value=o),label:"密碼 (PWD)",type:"password","prepend-inner-icon":"mdi-lock",variant:"outlined",density:"compact",disabled:c.value,required:"",onKeyup:N(b,["enter"])},null,8,["modelValue","disabled"])]),_:1}),t(me,{class:"d-flex justify-end"},{default:a(()=>[t(k,{color:"error",variant:"text",onClick:e[4]||(e[4]=o=>d.value=!1),disabled:c.value},{default:a(()=>[...e[15]||(e[15]=[u(" 取消 ",-1)])]),_:1},8,["disabled"]),t(k,{color:"primary",variant:"flat",loading:c.value,onClick:b,disabled:!f.value||!p.value},{default:a(()=>[...e[16]||(e[16]=[u(" 確認登入 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:3})}}}),Ge=h(ke,[["__scopeId","data-v-0e35b27b"]]);export{Ge as default};
