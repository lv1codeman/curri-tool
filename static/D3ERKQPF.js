import{_ as O,l as p,o as c,w as a,b as t,d as n,t as M,e as Q,h as G,r as o,p as J,f as K,c as W,m as X,F as Y,q as Z,a as I,s as ee}from"#entry";import{a as z,V as te}from"./C8WRQOr-.js";import{b as H,V as D,a as S,c as ae}from"./Bt-Lg9Yq.js";import{V as le}from"./CrRjTCCi.js";import{V as $,a as k}from"./XGYclXl8.js";import{V as E}from"./IZXj_S-L.js";import{V as L,a as re}from"./C9RONKOs.js";import{V as oe}from"./8YB82fyE.js";import{V as se,a as ne}from"./CqEnn2mQ.js";import{V as ie}from"./DKpZsHsa.js";import{V as ue}from"./Bs6P97i3.js";import"./BVTHWD1S.js";import"./CeZwhVst.js";import"./C1UajEuD.js";import"./olVGSFH9.js";import"./BvfaC3Sv.js";import"./CsFBHHeY.js";import"./BFs1KdCe.js";import"./CY2eiWj5.js";import"./CcGyTVB8.js";const de={__name:"MemeCard",props:{title:String,imageUrl:String},emits:["copy"],setup(f){return(V,m)=>(c(),p(D,{hover:"",class:"mx-auto cursor-pointer h-100",onClick:m[0]||(m[0]=v=>V.$emit("copy",{url:f.imageUrl,title:f.title}))},{default:a(()=>[t(z,{src:f.imageUrl,height:"200px",cover:"",class:"align-end"},{default:a(()=>[t(H,{class:"text-white bg-black-alpha-50"},{default:a(()=>[n(M(f.title),1)]),_:1})]),_:1},8,["src"])]),_:1}))}},ce=O(de,[["__scopeId","data-v-99d7eba3"]]),me=["onClick"],pe=Q({__name:"Meme",setup(f){const{$curridataAPI:V}=G(),m=o([]),v=o(""),h=o(!0),y=o(!1),w=o(!1),g=o(""),i=o(null),_=o(!1),F=o(""),j=o("success");async function A(){h.value=!0;try{const r=await V.get("/api/memes");m.value=r.data}catch(r){console.error("無法取得梗圖列表:",r),u("❌ 無法連線至伺服器","error")}finally{h.value=!1}}async function q(){if(!i.value||!g.value){u("請輸入名稱並選擇圖片","warning");return}w.value=!0;const r=new FormData,e=Array.isArray(i.value)?i.value[0]:i.value;r.append("file",e),r.append("title",g.value);try{await V.post("/api/upload-meme",r,{headers:{"Content-Type":"multipart/form-data"}}),u("✅ 梗圖上傳成功！","success"),P(),await A()}catch{u("❌ 上傳失敗","error")}finally{w.value=!1}}const B=J(()=>{if(!v.value)return m.value;const r=v.value.toLowerCase().trim().split(/\s+/);return m.value.filter(e=>{const d=e.title.toLowerCase();return r.every(l=>d.includes(l))})});async function N({url:r,title:e}){try{const d=r.replace("http://","https://")+`?t=${Date.now()}`,l=await fetch(d,{headers:{"ngrok-skip-browser-warning":"true"}});if(!l.ok)throw new Error(`HTTP 錯誤: ${l.status}`);const U=await l.blob(),s=new Image;s.crossOrigin="anonymous";const T=URL.createObjectURL(U);s.src=T,await new Promise((x,C)=>{s.onload=x,s.onerror=()=>C(new Error("Canvas 渲染失敗"))});const b=document.createElement("canvas");b.width=s.width,b.height=s.height,b.getContext("2d")?.drawImage(s,0,0),b.toBlob(async x=>{if(x)try{const C=new ClipboardItem({"image/png":x});await navigator.clipboard.write([C]),u(`✅ 已複製 「${e}」`,"success")}catch{u("❌ 寫入剪貼簿失敗","error")}finally{URL.revokeObjectURL(T)}},"image/png")}catch{u("❌ 複製失敗","error")}}function P(){y.value=!1,g.value="",i.value=null}function u(r,e="success"){F.value=r,j.value=e,_.value=!0}function R(r){return r?r.replace("http://","https://"):""}return K(()=>{A()}),(r,e)=>{const d=ce;return c(),p(le,null,{default:a(()=>[t($,{justify:"center",class:"mb-6"},{default:a(()=>[t(k,{cols:"12",md:"6",class:"d-flex align-center"},{default:a(()=>[t(E,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=l=>v.value=l),label:"搜尋梗圖關鍵字...","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"",class:"mr-4"},null,8,["modelValue"]),t(L,{color:"primary","prepend-icon":"mdi-upload",onClick:e[1]||(e[1]=l=>y.value=!0)},{default:a(()=>[...e[6]||(e[6]=[n(" 上傳梗圖 ",-1)])]),_:1})]),_:1})]),_:1}),h.value?(c(),p($,{key:1,justify:"center"},{default:a(()=>[t(k,{cols:"12",class:"text-center py-12"},{default:a(()=>[t(re,{indeterminate:"",color:"primary"}),e[9]||(e[9]=I("p",{class:"mt-4"},"梗圖載入中...",-1))]),_:1})]),_:1})):(c(),p($,{key:0,class:"px-15"},{default:a(()=>[(c(!0),W(Y,null,Z(B.value,(l,U)=>(c(),p(k,{key:U,cols:"12",sm:"6",md:"4",lg:"3",class:"py-4"},{default:a(()=>[t(oe,{"open-on-hover":"","open-delay":200,location:"top center",offset:"15",transition:"scale-transition"},{activator:a(({props:s})=>[I("div",ee({ref_for:!0},s,{class:"cursor-pointer transition-card",onClick:T=>N(l)}),[t(d,{title:l.title,"image-url":R(l.url),onCopy:N},null,8,["title","image-url"])],16,me)]),default:a(()=>[t(D,{width:"300",elevation:"24",class:"rounded-xl overflow-hidden border"},{default:a(()=>[t(z,{src:R(l.url),"max-height":"400",contain:"",class:"bg-grey-darken-4"},null,8,["src"]),t(S,{class:"bg-surface text-center py-2 font-weight-bold"},{default:a(()=>[n(M(l.title),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),B.value.length===0?(c(),p(k,{key:0,cols:"12",class:"text-center py-12"},{default:a(()=>[t(te,{size:"64",color:"grey-lighten-1"},{default:a(()=>[...e[7]||(e[7]=[n("mdi-image-search-outline",-1)])]),_:1}),e[8]||(e[8]=I("p",{class:"text-grey mt-2"},"找不到相關梗圖，換個關鍵字試試？",-1))]),_:1})):X("",!0)]),_:1})),t(se,{modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=l=>y.value=l),"max-width":"450px",persistent:""},{default:a(()=>[t(D,null,{default:a(()=>[t(H,{class:"bg-primary text-white"},{default:a(()=>[...e[10]||(e[10]=[n("上傳新梗圖",-1)])]),_:1}),t(S,{class:"pt-8 px-6"},{default:a(()=>[t(E,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=l=>g.value=l),label:"梗圖描述與關鍵字",variant:"outlined",placeholder:"例如：熊貓驚訝 表情包 嚇死我了",hint:"輸入愈詳細，之後搜尋愈容易找到喔！","persistent-hint":"",class:"mb-10"},null,8,["modelValue"]),t(ie,{modelValue:i.value,"onUpdate:modelValue":e[3]||(e[3]=l=>i.value=l),label:"選擇圖片檔案",accept:"image/*",variant:"outlined","prepend-icon":"mdi-camera","show-size":1024},null,8,["modelValue"])]),_:1}),t(ae,null,{default:a(()=>[t(ne),t(L,{variant:"text",onClick:P,disabled:w.value},{default:a(()=>[...e[11]||(e[11]=[n("取消",-1)])]),_:1},8,["disabled"]),t(L,{color:"primary",variant:"elevated",loading:w.value,onClick:q},{default:a(()=>[...e[12]||(e[12]=[n("確認上傳",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ue,{modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=l=>_.value=l),color:j.value,location:"bottom right",timeout:"3000"},{default:a(()=>[n(M(F.value),1)]),_:1},8,["modelValue","color"])]),_:1})}}}),je=O(pe,[["__scopeId","data-v-fddaa4af"]]);export{je as default};
