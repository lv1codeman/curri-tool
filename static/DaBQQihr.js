import{u as pe,V as N,a as j,b as ve,m as me,c as ye}from"./Ca5UShn9.js";import{x as L,q as p,y as he,z as ge,A as Fe,B as O,C as M,r as D,D as be,E as ke,G as we,H as Ce,b as g,a as v,F as I,v as V,n as De,I as Ie,J as Ve}from"#entry";import{f as Se}from"./olVGSFH9.js";import{V as Ae}from"./CyiZ1XMW.js";import{u as Be}from"./B1Ixl-qY.js";function Pe(){function e(i){return[...i.dataTransfer?.items??[]].filter(l=>l.kind==="file").map(l=>l.webkitGetAsEntry()).filter(Boolean).length>0||[...i.dataTransfer?.files??[]].length>0}async function a(i){const o=[],l=[...i.dataTransfer?.items??[]].filter(n=>n.kind==="file").map(n=>n.webkitGetAsEntry()).filter(Boolean);if(l.length)for(const n of l){const c=await G(n,W(".",n));o.push(...c.map(r=>r.file))}else o.push(...i.dataTransfer?.files??[]);return o}return{handleDrop:a,hasFilesOrFolders:e}}function G(e){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new Promise((i,o)=>{e.isFile?e.file(n=>i([{file:n,path:a}]),o):e.isDirectory&&e.createReader().readEntries(async n=>{const c=[];for(const r of n)c.push(...await G(r,W(a,r)));i(c)})})}function W(e,a){return a.isDirectory?`${e}/${a.name}`:e}const Te=L({filterByType:String},"file-accept");function Re(e){const a=p(()=>e.filterByType?ze(e.filterByType):null);function i(o){if(a.value){const l=o.filter(a.value);return{accepted:l,rejected:o.filter(n=>!l.includes(n))}}return{accepted:o,rejected:[]}}return{filterAccepted:i}}function ze(e){const a=e.split(",").map(n=>n.trim().toLowerCase()),i=a.filter(n=>n.startsWith(".")),o=a.filter(n=>n.endsWith("/*")),l=a.filter(n=>!i.includes(n)&&!o.includes(n));return n=>{const c=n.name.split(".").at(-1)?.toLowerCase()??"",r=n.type.split("/").at(0)?.toLowerCase()??"";return l.includes(n.type)||i.includes(`.${c}`)||o.includes(`${r}/*`)}}const $e=L({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},truncateLength:{type:[Number,String],default:22},...ye({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>O(e).every(a=>a!=null&&typeof a=="object")},...Te(),...me({clearable:!0})},"VFileInput"),Oe=he()({name:"VFileInput",inheritAttrs:!1,props:$e(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0,rejected:e=>!0},setup(e,a){let{attrs:i,emit:o,slots:l}=a;const{t:n}=ge(),{filterAccepted:c}=Re(e),r=Fe(e,"modelValue",e.modelValue,t=>O(t),t=>!e.multiple&&Array.isArray(t)?t[0]:t),{isFocused:y,focus:q,blur:H}=pe(e),S=p(()=>typeof e.showSize!="boolean"?e.showSize:void 0),A=p(()=>(r.value??[]).reduce((t,s)=>{let{size:f=0}=s;return t+f},0)),B=p(()=>M(A.value,S.value)),F=p(()=>(r.value??[]).map(t=>{const{name:s="",size:f=0}=t,d=ee(s);return e.showSize?`${d} (${M(f,S.value)})`:d})),J=p(()=>{const t=r.value?.length??0;return e.showSize?n(e.counterSizeString,t,B.value):n(e.counterString,t)}),P=D(),T=D(),u=D(),K=be(()=>y.value||e.active),R=p(()=>["plain","underlined"].includes(e.variant)),h=ke(!1),{handleDrop:U,hasFilesOrFolders:_}=Pe();function b(){u.value!==document.activeElement&&u.value?.focus(),y.value||q()}function Q(t){u.value?.click()}function X(t){o("mousedown:control",t)}function Y(t){u.value?.click(),o("click:control",t)}function Z(t){t.stopPropagation(),b(),Ie(()=>{r.value=[],Ve(e["onClick:clear"],t)})}function ee(t){if(t.length<Number(e.truncateLength))return t;const s=Math.floor((Number(e.truncateLength)-1)/2);return`${t.slice(0,s)}â€¦${t.slice(t.length-s)}`}function te(t){t.preventDefault(),t.stopImmediatePropagation(),h.value=!0}function ne(t){t.preventDefault(),h.value=!1}async function le(t){if(t.preventDefault(),t.stopImmediatePropagation(),h.value=!1,!u.value||!_(t))return;const s=await U(t);z(s)}function ae(t){if(!(!t.target||t.repack))if(e.filterByType)z([...t.target.files]);else{const s=t.target;r.value=[...s.files??[]]}}function z(t){const s=new DataTransfer,{accepted:f,rejected:d}=c(t);d.length&&o("rejected",d);for(const w of f)s.items.add(w);u.value.files=s.files,r.value=[...s.files];const k=new Event("change",{bubbles:!0});k.repack=!0,u.value.dispatchEvent(k)}return we(r,t=>{(!Array.isArray(t)||!t.length)&&u.value&&(u.value.value="")}),Be(()=>{const t=!!(l.counter||e.counter),s=!!(t||l.details),[f,d]=Ce(i),{modelValue:k,...w}=N.filterProps(e),ie={...j.filterProps(e),"onClick:clear":Z},re=i.webkitdirectory!==void 0&&i.webkitdirectory!==!1?void 0:e.filterByType??String(i.accept);return g(N,V({ref:P,modelValue:e.multiple?r.value:r.value[0],class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--dragging":h.value,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":R.value},e.class],style:e.style,"onClick:prepend":Q},f,w,{centerAffix:!R.value,focused:y.value}),{...l,default:C=>{let{id:oe,isDisabled:$,isDirty:x,isReadonly:E,isValid:se,hasDetails:ue}=C;return g(j,V({ref:T,prependIcon:e.prependIcon,onMousedown:X,onClick:Y,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},ie,{id:oe.value,active:K.value||x.value,dirty:x.value||e.dirty,disabled:$.value,focused:y.value,details:ue.value,error:se.value===!1,onDragover:te,onDrop:le}),{...l,default:ce=>{let{props:{class:fe,...de}}=ce;return v(I,null,[v("input",V({ref:u,type:"file",accept:re,readonly:E.value,disabled:$.value,multiple:e.multiple,name:e.name,onClick:m=>{m.stopPropagation(),E.value&&m.preventDefault(),b()},onChange:ae,onDragleave:ne,onFocus:b,onBlur:H},de,d),null),v("div",{class:De(fe)},[!!r.value?.length&&!e.hideInput&&(l.selection?l.selection({fileNames:F.value,totalBytes:A.value,totalBytesReadable:B.value}):e.chips?F.value.map(m=>g(Ae,{key:m,size:"small",text:m},null)):F.value.join(", "))])])}})},details:s?C=>v(I,null,[l.details?.(C),t&&v(I,null,[v("span",null,null),g(ve,{active:!!r.value?.length,value:J.value,disabled:e.disabled},l.counter)])]):void 0})}),Se({},P,T,u)}});export{Oe as V};
