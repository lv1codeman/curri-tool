import{_ as F}from"./DCv_lsF7.js";import{y as j,x as q,A as K,ad as R,D as B,r as g,q as k,v as V,b as t,ae as Y,e as E,h as G,f as J,l as v,o as p,w as a,m as T,a as D,d as s,c as W,F as H,t as A,n as Q,aB as X,aC as P,aD as N,_ as Z}from"#entry";import{V as h,a as ee,b as te}from"./DrOeP7j6.js";import{a as ae,V as oe}from"./K46MHAgd.js";import{V as b}from"./Nvx-AIXv.js";import{V as le,b as _}from"./CiMATjOX.js";import{V as r}from"./di2xmGk0.js";import{a as O,m as re}from"./FtWSywy7.js";import{f as ie}from"./olVGSFH9.js";import{u as ne}from"./DNe2gOCb.js";import{u as se}from"./BsiP8vYj.js";import{V as U}from"./B6XLVMJ2.js";import{V as ue}from"./D5rSoGI3.js";import{V as L,b as M,a as $,c as de}from"./DO8_Cxv-.js";import{V as me}from"./1nzPMNhC.js";import{V as ce}from"./CtbRvetj.js";import{V as z}from"./C-2OP4mh.js";import{V as pe}from"./bKQZaOkP.js";import"./r6yzdEX_.js";import"./DkogjsBj.js";import"./Ci80T-cT.js";import"./Dn88HoyX.js";import"./BKnBEunE.js";import"./DDBeEnLp.js";const fe=q({id:String,interactive:Boolean,text:String,...Y(re({closeOnBack:!1,location:"end",locationStrategy:"connected",eager:!0,minWidth:0,offset:10,openOnClick:!1,openOnHover:!0,origin:"auto",scrim:!1,scrollStrategy:"reposition",stickToTarget:!0,transition:null}),["absolute","persistent"])},"VTooltip"),ve=j()({name:"VTooltip",props:fe(),emits:{"update:modelValue":l=>!0},setup(l,C){let{slots:n}=C;const u=K(l,"modelValue"),{scopeId:f}=ne(),c=R(),d=B(()=>l.id||`v-tooltip-${c}`),m=g(),y=k(()=>l.location.split(" ").length>1?l.location:l.location+" center"),w=k(()=>l.origin==="auto"||l.origin==="overlap"||l.origin.split(" ").length>1||l.location.split(" ").length>1?l.origin:l.origin+" center"),x=B(()=>l.transition!=null?l.transition:u.value?"scale-transition":"fade-transition"),I=k(()=>V({"aria-describedby":d.value},l.activatorProps));return se(()=>{const i=O.filterProps(l);return t(O,V({ref:m,class:["v-tooltip",{"v-tooltip--interactive":l.interactive},l.class],style:l.style,id:d.value},i,{modelValue:u.value,"onUpdate:modelValue":e=>u.value=e,transition:x.value,absolute:!0,location:y.value,origin:w.value,persistent:!0,role:"tooltip",activatorProps:I.value,_disableGlobalStack:!0},f),{activator:n.activator,default:function(){for(var e=arguments.length,S=new Array(e),o=0;o<e;o++)S[o]=arguments[o];return n.default?.(...S)??l.text}})}),ie({},m)}}),ge={class:"d-flex align-center pr-4"},Ve={class:"mr-3 text-subtitle-1 font-weight-bold"},ye=E({__name:"layout1",setup(l){const{$curridataAPI:C}=G(),n=g(null),u=g(!1),f=g(""),c=g(""),d=g(!1),m=g(""),y=k(()=>!!n.value),w=k(()=>n.value&&n.value.auth==="admin");J(()=>{if(typeof localStorage<"u"){const i=localStorage.getItem("curridata_user");if(i)try{n.value=JSON.parse(i)}catch(e){console.error("解析 localStorage 使用者狀態失敗:",e),localStorage.removeItem("curridata_user")}}});async function x(){if(!f.value||!c.value){m.value="請輸入完整的帳號和密碼。";return}d.value=!0,m.value="";try{const i=await C.post("/api/user_login",{username:f.value,password:c.value}),e={name:i.data.user.name,auth:i.data.user.auth,username:i.data.user.username};n.value=e,u.value=!1,typeof localStorage<"u"&&localStorage.setItem("curridata_user",JSON.stringify(e)),c.value="",N("/welcome",{replace:!0})}catch(i){i.response?.status===401?m.value=i.response?.data?.detail||"帳號或密碼錯誤，請重新輸入。":(console.error("登入 API 錯誤:",i),m.value="伺服器或網路錯誤，請稍後再試。"),n.value=null,typeof localStorage<"u"&&localStorage.removeItem("curridata_user")}finally{d.value=!1}}function I(){n.value=null,typeof localStorage<"u"&&localStorage.removeItem("curridata_user"),alert("您已登出。"),N("/",{replace:!0})}return(i,e)=>{const S=F;return p(),v(pe,null,{default:a(()=>[t(h,{app:""},{default:a(()=>[t(S,{to:"/"},{default:a(()=>[t(ee,{class:"pl-4"},{default:a(()=>[...e[6]||(e[6]=[s("課務輔助工具",-1)])]),_:1})]),_:1}),t(ae),D("div",ge,[y.value?(p(),W(H,{key:0},[D("span",Ve," 歡迎，"+A(n.value.name)+" ("+A(n.value.username)+") ",1),t(b,{"prepend-icon":"mdi-logout",color:"error",variant:"flat",onClick:I,size:"large"},{default:a(()=>[...e[7]||(e[7]=[s(" 登出 ",-1)])]),_:1})],64)):(p(),v(b,{key:1,"prepend-icon":"mdi-login",color:"primary",variant:"flat",onClick:e[0]||(e[0]=o=>u.value=!0),size:"large"},{default:a(()=>[...e[8]||(e[8]=[s(" 登入系統 ",-1)])]),_:1}))])]),_:1}),y.value?(p(),v(te,{key:0,"expand-on-hover":"",permanent:"",rail:"",app:""},{default:a(()=>[t(le,{nav:""},{default:a(()=>[t(r,{title:"公告消息",link:"",to:"/welcome","prepend-icon":"mdi-home-outline"}),t(r,{title:"資訊速查",link:"",to:"/Info/Info","prepend-icon":"mdi-information"}),t(_,{value:"database_maintenance"},{activator:a(({props:o})=>[t(r,V(o,{"prepend-icon":"mdi-database-cog",title:"資料庫維護"}),null,16)]),default:a(()=>[t(r,{title:"系所表維護",link:"",to:"/DB/DBmaintain","prepend-icon":"mdi-table-edit"}),t(ve,{text:"班級-系所簡稱對照表維護",location:"end"},{activator:a(({props:o})=>[t(r,V(o,{title:"班級-系所簡稱對照表維護",link:"",to:"/DB/ClassDeptshort","prepend-icon":"mdi-compare-horizontal"}),null,16)]),_:1}),t(r,{title:"課務承辦維護",link:"",to:"/DB/CurriAgent","prepend-icon":"mdi-account-edit"})]),_:1}),t(_,{value:"curriculum_tools"},{activator:a(({props:o})=>[t(r,V(o,{"prepend-icon":"mdi-tools",title:"課務工具"}),null,16)]),default:a(()=>[t(r,{title:"班級簡稱轉換",link:"",to:"/Converters/ClassToOthers","prepend-icon":"mdi-file-swap"}),t(r,{title:"學制轉換",link:"",to:"/Converters/SIDtoSYS","prepend-icon":"mdi-file-swap"})]),_:1}),t(_,{value:"tools"},{activator:a(({props:o})=>[t(r,V(o,{"prepend-icon":"mdi-star-circle-outline",title:"其他工具"}),null,16)]),default:a(()=>[t(r,{title:"Youtube影片下載",link:"",to:"/Tools/YTconverter","prepend-icon":"mdi-download-box"})]),_:1}),w.value?(p(),v(_,{key:0,value:"sixer"},{activator:a(({props:o})=>[t(r,V(o,{"prepend-icon":"mdi-star-circle-outline",title:"Sixer"}),null,16)]),default:a(()=>[t(r,{title:"梗圖搜尋",link:"",to:"/Sixer/Meme","prepend-icon":"mdi-image"}),t(r,{title:"Minecraft",link:"",to:"/Sixer/Minecraft","prepend-icon":"mdi-download-box"}),t(r,{title:"存檔更新",link:"",to:"/Sixer/Upload","prepend-icon":"mdi-download-box"})]),_:1})):T("",!0)]),_:1})]),_:1})):T("",!0),y.value?(p(),v(U,{key:1,class:Q(["d-flex justify-center mt-2",{"ml-0":!y.value}])},{default:a(()=>[t(ue,null,{default:a(()=>[X(i.$slots,"default",{},void 0,!0)]),_:3})]),_:3},8,["class"])):(p(),v(U,{key:2,class:"d-flex align-center justify-center"},{default:a(()=>[t(L,{class:"text-center pa-10",elevation:"5","max-width":"500"},{default:a(()=>[t(me,{color:"warning",size:"60",class:"mb-4"},{default:a(()=>[...e[9]||(e[9]=[s("mdi-lock-alert",-1)])]),_:1}),t(M,{class:"text-h5"},{default:a(()=>[...e[10]||(e[10]=[s("需要登入",-1)])]),_:1}),t($,{class:"text-subtitle-1"},{default:a(()=>[...e[11]||(e[11]=[s(" 請點擊右上角「登入系統」以存取課務輔助工具。 ",-1)])]),_:1}),t(b,{color:"primary",variant:"flat",class:"mt-4",onClick:e[1]||(e[1]=o=>u.value=!0)},{default:a(()=>[...e[12]||(e[12]=[s(" 前往登入 ",-1)])]),_:1})]),_:1})]),_:1})),t(oe,{modelValue:u.value,"onUpdate:modelValue":e[5]||(e[5]=o=>u.value=o),"max-width":"400"},{default:a(()=>[t(L,null,{default:a(()=>[t(M,{class:"text-h5 primary lighten-2"},{default:a(()=>[...e[13]||(e[13]=[s(" 使用者登入 ",-1)])]),_:1}),t($,{class:"pt-4"},{default:a(()=>[m.value?(p(),v(ce,{key:0,type:"error",density:"compact",class:"mb-3"},{default:a(()=>[s(A(m.value),1)]),_:1})):T("",!0),t(z,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=o=>f.value=o),label:"帳號 (ACCOUNT)","prepend-inner-icon":"mdi-account",variant:"outlined",density:"compact",disabled:d.value,required:"",onKeyup:P(x,["enter"])},null,8,["modelValue","disabled"]),t(z,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=o=>c.value=o),label:"密碼 (PWD)",type:"password","prepend-inner-icon":"mdi-lock",variant:"outlined",density:"compact",disabled:d.value,required:"",onKeyup:P(x,["enter"])},null,8,["modelValue","disabled"])]),_:1}),t(de,{class:"d-flex justify-end"},{default:a(()=>[t(b,{color:"error",variant:"text",onClick:e[4]||(e[4]=o=>u.value=!1),disabled:d.value},{default:a(()=>[...e[14]||(e[14]=[s(" 取消 ",-1)])]),_:1},8,["disabled"]),t(b,{color:"primary",variant:"flat",loading:d.value,onClick:x,disabled:!f.value||!c.value},{default:a(()=>[...e[15]||(e[15]=[s(" 確認登入 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:3})}}}),Re=Z(ye,[["__scopeId","data-v-d4826c83"]]);export{Re as default};
