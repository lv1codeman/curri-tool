import{_ as F}from"./CqrPuHow.js";import{s as j,p as q,x as E,ad as K,A as B,r as g,q as k,E as V,b as t,ae as R,e as Y,h as G,f as J,l as v,o as p,w as a,m as T,a as D,d as s,c as W,F as H,t as A,n as Q,aB as X,aC as P,aD as N,_ as Z}from"#entry";import{V as h,a as ee,b as te}from"./BBKGS7nk.js";import{V as ae,a as oe}from"./BdkBkcK0.js";import{d as b,V as O,b as U,a as L,e as le}from"./4Td1EdPI.js";import{V as re,b as _}from"./DwU9_ecP.js";import{V as i}from"./5HE8DmgL.js";import{a as $,m as ie}from"./B3Ie5AgL.js";import{f as ne}from"./olVGSFH9.js";import{u as se}from"./Bj8GeUNe.js";import{u as ue}from"./7kqxRFU_.js";import{V as z}from"./BjPxt-pj.js";import{V as de}from"./DK9HV8Ct.js";import{V as me}from"./un5phzSR.js";import{V as ce}from"./dnzGQPiF.js";import{V as M}from"./D20qIuBp.js";import{V as pe}from"./1mk5S31q.js";import"./CkvUrmgQ.js";import"./Dziq4udP.js";import"./B19g07ev.js";import"./CgPuvXI5.js";import"./KYABtfDM.js";import"./DifO3NxO.js";const fe=q({id:String,interactive:Boolean,text:String,...R(ie({closeOnBack:!1,location:"end",locationStrategy:"connected",eager:!0,minWidth:0,offset:10,openOnClick:!1,openOnHover:!0,origin:"auto",scrim:!1,scrollStrategy:"reposition",stickToTarget:!0,transition:null}),["absolute","persistent"])},"VTooltip"),ve=j()({name:"VTooltip",props:fe(),emits:{"update:modelValue":l=>!0},setup(l,C){let{slots:n}=C;const u=E(l,"modelValue"),{scopeId:f}=se(),c=K(),d=B(()=>l.id||`v-tooltip-${c}`),m=g(),y=k(()=>l.location.split(" ").length>1?l.location:l.location+" center"),w=k(()=>l.origin==="auto"||l.origin==="overlap"||l.origin.split(" ").length>1||l.location.split(" ").length>1?l.origin:l.origin+" center"),x=B(()=>l.transition!=null?l.transition:u.value?"scale-transition":"fade-transition"),I=k(()=>V({"aria-describedby":d.value},l.activatorProps));return ue(()=>{const r=$.filterProps(l);return t($,V({ref:m,class:["v-tooltip",{"v-tooltip--interactive":l.interactive},l.class],style:l.style,id:d.value},r,{modelValue:u.value,"onUpdate:modelValue":e=>u.value=e,transition:x.value,absolute:!0,location:y.value,origin:w.value,persistent:!0,role:"tooltip",activatorProps:I.value,_disableGlobalStack:!0},f),{activator:n.activator,default:function(){for(var e=arguments.length,S=new Array(e),o=0;o<e;o++)S[o]=arguments[o];return n.default?.(...S)??l.text}})}),ne({},m)}}),ge={class:"d-flex align-center pr-4"},Ve={class:"mr-3 text-subtitle-1 font-weight-bold"},ye=Y({__name:"layout1",setup(l){const{$curridataAPI:C}=G(),n=g(null),u=g(!1),f=g(""),c=g(""),d=g(!1),m=g(""),y=k(()=>!!n.value),w=k(()=>n.value&&n.value.auth==="admin");J(()=>{if(typeof localStorage<"u"){const r=localStorage.getItem("curridata_user");if(r)try{n.value=JSON.parse(r)}catch(e){console.error("解析 localStorage 使用者狀態失敗:",e),localStorage.removeItem("curridata_user")}}});async function x(){if(!f.value||!c.value){m.value="請輸入完整的帳號和密碼。";return}d.value=!0,m.value="";try{const r=await C.post("/api/user_login",{username:f.value,password:c.value}),e={name:r.data.user.name,auth:r.data.user.auth,username:r.data.user.username};n.value=e,u.value=!1,typeof localStorage<"u"&&localStorage.setItem("curridata_user",JSON.stringify(e)),c.value="",N("/welcome",{replace:!0})}catch(r){r.response?.status===401?m.value=r.response?.data?.detail||"帳號或密碼錯誤，請重新輸入。":(console.error("登入 API 錯誤:",r),m.value="伺服器或網路錯誤，請稍後再試。"),n.value=null,typeof localStorage<"u"&&localStorage.removeItem("curridata_user")}finally{d.value=!1}}function I(){n.value=null,typeof localStorage<"u"&&localStorage.removeItem("curridata_user"),alert("您已登出。"),N("/",{replace:!0})}return(r,e)=>{const S=F;return p(),v(pe,null,{default:a(()=>[t(h,{app:""},{default:a(()=>[t(S,{to:"/"},{default:a(()=>[t(ee,{class:"pl-4"},{default:a(()=>[...e[6]||(e[6]=[s("課務輔助工具",-1)])]),_:1})]),_:1}),t(ae),D("div",ge,[y.value?(p(),W(H,{key:0},[D("span",Ve," 歡迎，"+A(n.value.name)+" ("+A(n.value.username)+") ",1),t(b,{"prepend-icon":"mdi-logout",color:"error",variant:"flat",onClick:I,size:"large"},{default:a(()=>[...e[7]||(e[7]=[s(" 登出 ",-1)])]),_:1})],64)):(p(),v(b,{key:1,"prepend-icon":"mdi-login",color:"primary",variant:"flat",onClick:e[0]||(e[0]=o=>u.value=!0),size:"large"},{default:a(()=>[...e[8]||(e[8]=[s(" 登入系統 ",-1)])]),_:1}))])]),_:1}),y.value?(p(),v(te,{key:0,"expand-on-hover":"",permanent:"",rail:"",app:""},{default:a(()=>[t(re,{nav:""},{default:a(()=>[t(i,{title:"公告消息",link:"",to:"/welcome","prepend-icon":"mdi-home-outline"}),t(_,{value:"database_maintenance"},{activator:a(({props:o})=>[t(i,V(o,{"prepend-icon":"mdi-database-cog",title:"資料庫維護"}),null,16)]),default:a(()=>[t(i,{title:"系所表維護",link:"",to:"/DB/DBmaintain","prepend-icon":"mdi-table-edit"}),t(ve,{text:"班級-系所簡稱對照表維護",location:"end"},{activator:a(({props:o})=>[t(i,V(o,{title:"班級-系所簡稱對照表維護",link:"",to:"/DB/ClassDeptshort","prepend-icon":"mdi-compare-horizontal"}),null,16)]),_:1}),t(i,{title:"課務承辦維護",link:"",to:"/DB/CurriAgent","prepend-icon":"mdi-account-edit"})]),_:1}),t(_,{value:"curriculum_tools"},{activator:a(({props:o})=>[t(i,V(o,{"prepend-icon":"mdi-tools",title:"課務工具"}),null,16)]),default:a(()=>[t(i,{title:"班級簡稱轉換",link:"",to:"/Converters/ClassToOthers","prepend-icon":"mdi-file-swap"}),t(i,{title:"學制轉換",link:"",to:"/Converters/SIDtoSYS","prepend-icon":"mdi-file-swap"})]),_:1}),t(_,{value:"tools"},{activator:a(({props:o})=>[t(i,V(o,{"prepend-icon":"mdi-star-circle-outline",title:"其他工具"}),null,16)]),default:a(()=>[t(i,{title:"Youtube影片下載",link:"",to:"/Tools/YTconverter","prepend-icon":"mdi-download-box"})]),_:1}),w.value?(p(),v(_,{key:0,value:"sixer"},{activator:a(({props:o})=>[t(i,V(o,{"prepend-icon":"mdi-star-circle-outline",title:"Sixer"}),null,16)]),default:a(()=>[t(i,{title:"Minecraft",link:"",to:"/Sixer/Minecraft","prepend-icon":"mdi-download-box"}),t(i,{title:"存檔更新",link:"",to:"/Sixer/Upload","prepend-icon":"mdi-download-box"})]),_:1})):T("",!0)]),_:1})]),_:1})):T("",!0),y.value?(p(),v(z,{key:1,class:Q(["d-flex justify-center mt-2",{"ml-0":!y.value}])},{default:a(()=>[t(de,null,{default:a(()=>[X(r.$slots,"default",{},void 0,!0)]),_:3})]),_:3},8,["class"])):(p(),v(z,{key:2,class:"d-flex align-center justify-center"},{default:a(()=>[t(O,{class:"text-center pa-10",elevation:"5","max-width":"500"},{default:a(()=>[t(me,{color:"warning",size:"60",class:"mb-4"},{default:a(()=>[...e[9]||(e[9]=[s("mdi-lock-alert",-1)])]),_:1}),t(U,{class:"text-h5"},{default:a(()=>[...e[10]||(e[10]=[s("需要登入",-1)])]),_:1}),t(L,{class:"text-subtitle-1"},{default:a(()=>[...e[11]||(e[11]=[s(" 請點擊右上角「登入系統」以存取課務輔助工具。 ",-1)])]),_:1}),t(b,{color:"primary",variant:"flat",class:"mt-4",onClick:e[1]||(e[1]=o=>u.value=!0)},{default:a(()=>[...e[12]||(e[12]=[s(" 前往登入 ",-1)])]),_:1})]),_:1})]),_:1})),t(oe,{modelValue:u.value,"onUpdate:modelValue":e[5]||(e[5]=o=>u.value=o),"max-width":"400"},{default:a(()=>[t(O,null,{default:a(()=>[t(U,{class:"text-h5 primary lighten-2"},{default:a(()=>[...e[13]||(e[13]=[s(" 使用者登入 ",-1)])]),_:1}),t(L,{class:"pt-4"},{default:a(()=>[m.value?(p(),v(ce,{key:0,type:"error",density:"compact",class:"mb-3"},{default:a(()=>[s(A(m.value),1)]),_:1})):T("",!0),t(M,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=o=>f.value=o),label:"帳號 (ACCOUNT)","prepend-inner-icon":"mdi-account",variant:"outlined",density:"compact",disabled:d.value,required:"",onKeyup:P(x,["enter"])},null,8,["modelValue","disabled"]),t(M,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=o=>c.value=o),label:"密碼 (PWD)",type:"password","prepend-inner-icon":"mdi-lock",variant:"outlined",density:"compact",disabled:d.value,required:"",onKeyup:P(x,["enter"])},null,8,["modelValue","disabled"])]),_:1}),t(le,{class:"d-flex justify-end"},{default:a(()=>[t(b,{color:"error",variant:"text",onClick:e[4]||(e[4]=o=>u.value=!1),disabled:d.value},{default:a(()=>[...e[14]||(e[14]=[s(" 取消 ",-1)])]),_:1},8,["disabled"]),t(b,{color:"primary",variant:"flat",loading:d.value,onClick:x,disabled:!f.value||!c.value},{default:a(()=>[...e[15]||(e[15]=[s(" 確認登入 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:3})}}}),Ee=Z(ye,[["__scopeId","data-v-3f51f24a"]]);export{Ee as default};
