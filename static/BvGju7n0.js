import{D as T}from"./CT4w4KcT.js";import{h as _,r as o,K as N,q as E,f as G,c as y,b as C,o as I}from"#entry";import"./DnvMyz26.js";import"./B-Hxcajx.js";import"./BsiP8vYj.js";import"./CUuAJ6Ty.js";import"./D8bvMAuO.js";import"./BUz42rcT.js";import"./r6yzdEX_.js";import"./olVGSFH9.js";import"./BLczs9VA.js";import"./D9cJH8h2.js";import"./CpIx0c_z.js";import"./Ci80T-cT.js";import"./DskjslOh.js";import"./Dn88HoyX.js";import"./BWZpj2fS.js";import"./I2Lz-SGT.js";import"./DNe2gOCb.js";import"./DZueW8-K.js";import"./v4BGuXz-.js";import"./D5rSoGI3.js";import"./DZIxpjna.js";import"./BlKqekpN.js";import"./Caygb5uM.js";import"./DkogjsBj.js";const J={__name:"DBmaintain",setup(f){const{$curridataAPI:s}=_(),i=o(null);N({});const r=o([]),p=[{value:"ID",title:"ID",sortable:!1,width:"0px"},{value:"CAGENT_ID",title:"課務承辦人ID",sortable:!1,width:"0px"},{value:"AGENT_ID",title:"承辦人ID",sortable:!1,width:"0px"},{value:"COLLEGE",title:"學院全名"},{value:"COLLEGE_S",title:"學院簡稱"},{value:"DEPT",title:"系所全名"},{value:"DEPT_S",title:"系所簡稱"},{value:"STYPE",title:"學制"},{value:"AGENT_NAME",title:"承辦人"},{value:"AGENT_EXT",title:"承辦人分機"},{value:"AGENT_EMAIL",title:"承辦人Email"},{value:"CAGENT_NAME",title:"課務承辦人"},{value:"CAGENT_EXT",title:"課務承辦人分機"},{value:"CAGENT_EMAIL",title:"課務承辦人Email"},{value:"actions",title:"操作",sortable:!1}],n={get:"/get_depts",add:"/create_dept",update:"/update_dept/{id}",delete:"/delete_dept/{id}"},l=e=>!!e||"此欄位為必填。",d=async()=>{try{const e=await s.get("/get_cagents");r.value=e.data}catch(e){console.error("無法從 API 取得課務承辦人資料。",e)}},u=e=>{if(e.CAGENT){const t=r.value.find(a=>a.NAME===e.CAGENT);t&&(e.CAGENT=t,e.CAGENTEXT=t.EXT,e.CAGENTEMAIL=t.EMAIL)}},A=({key:e,value:t})=>{if(e==="CAGENT_NAME"&&t){const a=i.value.editedItem;a.CAGENT_ID=t.ID,a.CAGENT_NAME=t.NAME,a.CAGENT_EXT=t.EXT,a.CAGENT_EMAIL=t.EMAIL}},c=E(()=>[{key:"COLLEGE",label:"學院全名",type:"text",rules:[l]},{key:"COLLEGE_S",label:"學院簡稱",type:"text",rules:[l]},{key:"DEPT",label:"系所全名",type:"text",rules:[l]},{key:"DEPT_S",label:"系所簡稱",type:"text",rules:[l]},{key:"STYPE",label:"學制",type:"text",rules:[l]},{key:"AGENT_NAME",label:"承辦人",type:"text",rules:[l]},{key:"AGENT_EXT",label:"承辦人分機",type:"text",rules:[l]},{key:"AGENT_EMAIL",label:"承辦人Email",type:"text",rules:[l]},{key:"CAGENT_NAME",label:"課務承辦人",type:"select",rules:[l],items:r.value,"item-title":"NAME","return-object":!0},{key:"CAGENT_ID",label:"課務承辦人ID",type:"text",readonly:!0,class:"d-none",cellClass:"d-none"},{key:"CAGENT_EXT",label:"課務承辦人分機",type:"text",readonly:!0},{key:"CAGENT_EMAIL",label:"課務承辦人Email",type:"text",readonly:!0}]),m=E(()=>{const e=["CAGENT_ID","AGENT_ID"];return p.filter(t=>!e.includes(t.value))});return G(()=>{d()}),(e,t)=>(I(),y("div",null,[C(T,{ref_key:"dtCrudRef",ref:i,title:"系所表維護",tableTitle:"系所表",headers:m.value,apiUrl:"",apiEndpoints:n,formFields:c.value,itemSingular:"系所",onOnEdit:u,onFieldUpdated:A},null,8,["headers","formFields"])]))}};export{J as default};
