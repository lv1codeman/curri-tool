import{v as A,m as N,s as G,x as H,F,A as ee,y as ae,b as o,G as j,n as B,H as te,I as $,a as d,J as R,ad as le,r as g,ae as oe,af as se,Z as ne,_ as re,h as ue,aa as O,w as i,o as p,ac as L,d as y,t as S,c as E}from"#entry";import{V as ie}from"./BQTCiI5h.js";import{h as de,j as ce,f as ve,k as me,l as fe,n as pe,m as be,b as ye,c as ge,d as Ve,o as Ie,V as Z,g as U,i as ke}from"./BkueYBjA.js";import{g as Pe,h as Se,i as _e,j as xe,V as K,k as z,l as De,n as J,o as Ee,p as Ce,q as we,r as Oe,e as Le,f as Ne,d as Re,a as W,s as he}from"./B4LFs0lU.js";import{V as Y,a as Ae,d as Te,b as $e}from"./BJd9nfqI.js";import{c as ze,m as Ge,d as Me,b as Fe,a as Q}from"./BVAB5lBc.js";import{f as je}from"./olVGSFH9.js";import"./B76B4Zs4.js";const Be=globalThis.setInterval,Ue=de("v-alert-title"),Je=A({iconSize:[Number,String],iconSizes:{type:Array,default:()=>[["x-small",10],["small",16],["default",24],["large",28],["x-large",32]]}},"iconSize");function We(e,c){return{iconSize:N(()=>{const l=new Map(e.iconSizes),r=e.iconSize??c()??"default";return l.has(r)?l.get(r):r})}}const Ye=["success","info","warning","error"],qe=A({border:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["top","end","bottom","start"].includes(e)},borderColor:String,closable:Boolean,closeIcon:{type:$,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:e=>Ye.includes(e)},...Fe(),...Ve(),...Me(),...ge(),...Je(),...xe(),..._e(),...ye(),...Ge(),...te(),...be({variant:"flat"})},"VAlert"),T=G()({name:"VAlert",props:qe(),emits:{"click:close":e=>!0,"update:modelValue":e=>!0},setup(e,c){let{emit:f,slots:l}=c;const r=H(e,"modelValue"),u=F(()=>{if(e.icon!==!1)return e.type?e.icon??`$${e.type}`:e.icon}),{iconSize:t}=We(e,()=>e.prominent?44:void 0),{themeClasses:m}=ee(e),{colorClasses:V,colorStyles:_,variantClasses:I}=ce(()=>({color:e.color??e.type,variant:e.variant})),{densityClasses:x}=ve(e),{dimensionStyles:v}=ze(e),{elevationClasses:k}=me(e),{locationStyles:P}=Pe(e),{positionClasses:b}=Se(e),{roundedClasses:D}=fe(e),{textColorClasses:C,textColorStyles:w}=pe(()=>e.borderColor),{t:n}=ae(),a=F(()=>({"aria-label":n(e.closeLabel),onClick(s){r.value=!1,f("click:close",s)}}));return()=>{const s=!!(l.prepend||u.value),h=!!(l.title||e.title),X=!!(l.close||e.closable),M={density:e.density,icon:u.value,size:e.iconSize||e.prominent?t.value:void 0};return r.value&&o(e.tag,{class:B(["v-alert",e.border&&{"v-alert--border":!!e.border,[`v-alert--border-${e.border===!0?"start":e.border}`]:!0},{"v-alert--prominent":e.prominent},m.value,V.value,x.value,k.value,b.value,D.value,I.value,e.class]),style:j([_.value,v.value,P.value,e.style]),role:"alert"},{default:()=>[Ie(!1,"v-alert"),e.border&&d("div",{key:"border",class:B(["v-alert__border",C.value]),style:j(w.value)},null),s&&d("div",{key:"prepend",class:"v-alert__prepend"},[l.prepend?o(U,{key:"prepend-defaults",disabled:!u.value,defaults:{VIcon:{...M}}},l.prepend):o(Z,R({key:"prepend-icon"},M),null)]),d("div",{class:"v-alert__content"},[h&&o(Ue,{key:"title"},{default:()=>[l.title?.()??e.title]}),l.text?.()??e.text,l.default?.()]),l.append&&d("div",{key:"append",class:"v-alert__append"},[l.append()]),X&&d("div",{key:"close",class:"v-alert__close"},[l.close?o(U,{key:"close-defaults",defaults:{VBtn:{icon:e.closeIcon,size:"x-small",variant:"text"}}},{default:()=>[l.close?.({props:a.value})]}):o(K,R({key:"close-btn",icon:e.closeIcon,size:"x-small",variant:"text"},a.value),null)])]})}}}),He=A({...De({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),q=G()({name:"VRadio",props:He(),setup(e,c){let{slots:f}=c;return Q(()=>{const l=z.filterProps(e);return o(z,R(l,{class:["v-radio",e.class],style:e.style,type:"radio"}),f)}),{}}}),Ze=A({height:{type:[Number,String],default:"auto"},...Ee(),...se(Ce(),["multiple"]),trueIcon:{type:$,default:"$radioOn"},falseIcon:{type:$,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),Ke=G()({name:"VRadioGroup",inheritAttrs:!1,props:Ze(),emits:{"update:modelValue":e=>!0},setup(e,c){let{attrs:f,slots:l}=c;const r=le(),u=N(()=>e.id||`radio-group-${r}`),t=H(e,"modelValue"),m=g();return Q(()=>{const[V,_]=oe(f),I=J.filterProps(e),x=z.filterProps(e),v=l.label?l.label({label:e.label,props:{for:u.value}}):e.label;return o(J,R({ref:m,class:["v-radio-group",e.class],style:e.style},V,I,{modelValue:t.value,"onUpdate:modelValue":k=>t.value=k,id:u.value}),{...l,default:k=>{let{id:P,messagesId:b,isDisabled:D,isReadonly:C}=k;return d(ne,null,[v&&o(we,{id:P.value},{default:()=>[v]}),o(Oe,R(x,{id:P.value,"aria-describedby":b.value,defaultsTarget:"VRadio",trueIcon:e.trueIcon,falseIcon:e.falseIcon,type:e.type,disabled:D.value,readonly:C.value,"aria-labelledby":v?P.value:void 0,multiple:!1},_,{modelValue:t.value,"onUpdate:modelValue":w=>t.value=w}),l)])}})}),je({},m)}}),Qe={class:"d-flex justify-space-between align-center mb-2"},Xe={class:"d-flex justify-space-between align-center mb-4"},ea={class:"text-white font-weight-bold text-caption"},aa={key:0},ta={key:1},la={key:2},oa={key:3},sa={class:"custom-loader"},na={key:0},ra={key:1},ua="https://25d75d1b61db.ngrok-free.app",ia=2e3,da={__name:"YTconverter",setup(e){const c=g(""),f=g("mp3"),l=g(""),r=g(""),u=g(null),t=g("IDLE"),m=g(0),V=g(null),{$curridataAPI:_}=ue(),I=N(function(){return t.value==="PENDING"||t.value==="DOWNLOADING"?"primary":t.value==="COMPLETED"?"success":t.value==="FAILED"||t.value==="ERROR"?"error":"grey"}),x=N(function(){return t.value==="PENDING"?"等待伺服器處理...":t.value==="DOWNLOADING"?`下載中... (${m.value.toFixed(1)}%)`:t.value==="COMPLETED"?"下載完成！":t.value==="FAILED"?"任務失敗！":t.value==="ERROR"?"連線/輪詢錯誤":"準備就緒"}),v=N(function(){return t.value==="PENDING"||t.value==="DOWNLOADING"}),k=async function(){if(l.value="",r.value="",b(),!c.value.trim()||!c.value.startsWith("http")){l.value="請輸入有效的 YouTube 網址，並確保它以 http 或 https 開頭。";return}t.value="PENDING",m.value=0,u.value=null,r.value="正在提交下載任務...";try{const n=JSON.stringify({url:c.value,format:f.value}),a=await _.post("submit_download_job",n),s=a.data;let h=s.job_id||s.id||s.taskId;if(!h)throw s.error||s.message?new Error(`伺服器回傳錯誤: ${s.error||s.message}`):new Error(`伺服器回傳格式錯誤，找不到 job_id、id 或 taskId。實際回傳資料：${JSON.stringify(a)}`);u.value=h,r.value=`任務已成功提交，Job ID: ${u.value}。開始追蹤進度...`,P()}catch(n){console.error("提交任務失敗:",n);let a=n.message||(typeof n=="object"&&n!==null?JSON.stringify(n):String(n));l.value=`提交任務失敗：${a}`,t.value="FAILED"}},P=function(){b(),D(),V.value=Be(D,ia)},b=function(){V.value&&(clearInterval(V.value),V.value=null)},D=async function(){if(!u.value){b();return}try{const a=(await _.get(`download_status/${u.value}`)).data;if(!a.status)throw new Error("伺服器回傳狀態格式錯誤。");t.value=a.status,m.value=a.progress||0,t.value==="COMPLETED"?(b(),r.value="✅ 下載完成 (100%)！檔案已在伺服器準備完畢。正在啟動下載...",C()):t.value==="DOWNLOADING"?r.value=`下載中，進度更新至 ${m.value.toFixed(1)}%...`:t.value==="FAILED"&&(b(),l.value="❌ 任務處理失敗。請檢查網址或伺服器日誌。")}catch(n){console.error("輪詢錯誤:",n),b(),t.value="ERROR";let a=n.message||(typeof n=="object"&&n!==null?JSON.stringify(n):String(n));l.value=`輪詢狀態錯誤：${a}`}},C=function(){if(u.value&&t.value==="COMPLETED"){const n=`${ua}/download_file/${u.value}`,a=document.createElement("a");a.href=n,a.setAttribute("download",`media_download_${u.value}.${f.value}`),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),r.value="🎉 檔案下載已開始。瀏覽器將提示您儲存位置。",setTimeout(function(){t.value="IDLE",m.value=0,u.value=null},3e3)}},w=function(){(t.value==="IDLE"||t.value==="FAILED"||t.value==="ERROR")&&k()};return(n,a)=>(p(),O(ie,null,{default:i(()=>[o(ke,{fluid:""},{default:i(()=>[o(Le,{justify:"center",align:"start"},{default:i(()=>[o(Ne,{cols:"12",sm:"10",md:"8",lg:"6",xl:"5"},{default:i(()=>[o(Y,{class:"pa-4 pa-sm-8",elevation:"12",rounded:"xl"},{default:i(()=>[o(Ae,{class:"text-h4 text-sm-h3 text-center font-weight-bold mb-4"},{default:i(()=>[...a[5]||(a[5]=[y(" YouTube 媒體轉換器 (非同步) ",-1)])]),_:1}),o(Te,{class:"text-center mb-6"},{default:i(()=>[...a[6]||(a[6]=[y(" 輸入 YouTube 網址，選擇格式，伺服器將在背景處理任務。 ",-1)])]),_:1}),l.value?(p(),O(T,{key:0,type:"error",closable:"",icon:"mdi-alert-circle",variant:"tonal",class:"mb-4","onUpdate:modelValue":a[0]||(a[0]=s=>l.value="")},{default:i(()=>[a[7]||(a[7]=d("div",{class:"font-weight-medium"},"錯誤:",-1)),y(" "+S(l.value),1)]),_:1})):L("",!0),r.value&&t.value!=="COMPLETED"?(p(),O(T,{key:1,type:"info",icon:"mdi-information-outline",variant:"tonal",class:"mb-4"},{default:i(()=>[a[8]||(a[8]=d("div",{class:"font-weight-medium"},"狀態:",-1)),y(" "+S(r.value),1)]),_:1})):L("",!0),t.value==="COMPLETED"?(p(),O(T,{key:2,type:"success",icon:"mdi-check-all",variant:"tonal",class:"mb-4","onUpdate:modelValue":a[1]||(a[1]=s=>r.value="")},{default:i(()=>[a[9]||(a[9]=d("div",{class:"font-weight-medium"},"下載已完成!",-1)),y(" "+S(r.value),1)]),_:1})):L("",!0),o(Re,{modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=s=>c.value=s),label:"YouTube 影片網址",placeholder:"例如: https://www.youtube.com/watch?v=...",variant:"outlined",disabled:v.value,rules:[s=>!!s||"網址不能為空"],"prepend-inner-icon":"mdi-link-variant",clearable:"",class:"mb-6"},null,8,["modelValue","disabled","rules"]),o(Ke,{modelValue:f.value,"onUpdate:modelValue":a[3]||(a[3]=s=>f.value=s),label:"選擇輸出格式",inline:"",disabled:v.value,class:"mb-8"},{default:i(()=>[o(q,{label:"MP3 (音訊)",value:"mp3",color:"primary",icon:"mdi-music-box",class:"mr-4"}),o(q,{label:"MP4 (影片)",value:"mp4",color:"primary",icon:"mdi-video",class:"mr-4"})]),_:1},8,["modelValue","disabled"]),u.value?(p(),O(Y,{key:3,loading:v.value,color:I.value,variant:"tonal",class:"mb-6 pa-4"},{default:i(()=>[d("div",Qe,[a[10]||(a[10]=d("span",{class:"text-subtitle-1 font-weight-medium"},"任務 ID:",-1)),o(W,{color:I.value,variant:"flat",size:"small"},{default:i(()=>[y(S(u.value),1)]),_:1},8,["color"])]),d("div",Xe,[a[11]||(a[11]=d("span",{class:"text-subtitle-1 font-weight-medium"},"目前狀態:",-1)),o(W,{color:I.value,variant:"outlined",size:"default"},{default:i(()=>[y(S(x.value),1)]),_:1},8,["color"])]),o(he,{modelValue:m.value,"onUpdate:modelValue":a[4]||(a[4]=s=>m.value=s),color:I.value,height:"16",rounded:"",striped:"",class:"my-2"},{default:i(({value:s})=>[d("span",ea,S(s.toFixed(1))+"% ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["loading","color"])):L("",!0),o(K,{onClick:w,loading:v.value,disabled:v.value,color:v.value?"primary":"success",size:"x-large",block:"",elevation:"8",rounded:"lg",class:"text-button"},{loader:i(()=>[d("span",sa,[o(Z,{icon:"mdi-cached",class:"spin-icon"}),a[12]||(a[12]=y(" 處理中... ",-1))])]),default:i(()=>[t.value==="IDLE"||t.value==="FAILED"||t.value==="ERROR"?(p(),E("span",aa,"開始下載")):t.value==="COMPLETED"?(p(),E("span",ta,"下載完成 (點擊即可重新提交)")):t.value==="PENDING"?(p(),E("span",la,"提交中...")):t.value==="DOWNLOADING"?(p(),E("span",oa,S(x.value),1)):L("",!0)]),_:1},8,["loading","disabled","color"]),o($e,{class:"text-caption text-center mt-6 text-grey-darken-1"},{default:i(()=>[a[13]||(a[13]=y(" **備註:** ",-1)),v.value?(p(),E("span",na,"伺服器正在背景處理您的請求。請不要關閉頁面。")):(p(),E("span",ra,"下載時間取決於伺服器處理速度與檔案大小。"))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}},Va=re(da,[["__scopeId","data-v-eb09362f"]]);export{Va as default};
