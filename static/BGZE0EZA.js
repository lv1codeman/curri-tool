import{v as T,m as N,s as F,x as Z,F as B,A as ee,y as ae,b as o,G as j,n as U,H as te,I as G,a as i,J as h,ad as le,r as g,ae as oe,af as se,Z as ne,_ as re,ag as ue,h as ie,aa as R,w as r,o as p,ac as L,d as S,t as _,c as C}from"#entry";import{V as de}from"./DOYnzWTS.js";import{h as ce,j as ve,f as me,k as fe,l as pe,n as be,m as ye,b as ge,c as Ve,d as Ie,o as ke,V as K,g as Y,i as Pe}from"./DZrX2P9O.js";import{i as Se,j as _e,k as xe,l as De,V as Q,n as J,o as Ce,p as Ee,f as we,g as Oe,b as W,d as Re,q as Le,r as Ne,e as he}from"./BLsNmApK.js";import{c as Ae,m as Te,d as $e,b as ze,a as X}from"./CCg23xyY.js";import{b as M,m as Ge,c as Me,d as Fe,a as Be,V as q}from"./DC4_pOvL.js";import{f as je}from"./olVGSFH9.js";const Ue=globalThis.setInterval,Ye=ce("v-alert-title"),Je=T({iconSize:[Number,String],iconSizes:{type:Array,default:()=>[["x-small",10],["small",16],["default",24],["large",28],["x-large",32]]}},"iconSize");function We(e,V){return{iconSize:N(()=>{const l=new Map(e.iconSizes),v=e.iconSize??V()??"default";return l.has(v)?l.get(v):v})}}const qe=["success","info","warning","error"],He=T({border:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["top","end","bottom","start"].includes(e)},borderColor:String,closable:Boolean,closeIcon:{type:G,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:e=>qe.includes(e)},...ze(),...Ie(),...$e(),...Ve(),...Je(),...De(),...xe(),...ge(),...Te(),...te(),...ye({variant:"flat"})},"VAlert"),z=F()({name:"VAlert",props:He(),emits:{"click:close":e=>!0,"update:modelValue":e=>!0},setup(e,V){let{emit:I,slots:l}=V;const v=Z(e,"modelValue"),c=B(()=>{if(e.icon!==!1)return e.type?e.icon??`$${e.type}`:e.icon}),{iconSize:u}=We(e,()=>e.prominent?44:void 0),{themeClasses:d}=ee(e),{colorClasses:t,colorStyles:f,variantClasses:k}=ve(()=>({color:e.color??e.type,variant:e.variant})),{densityClasses:x}=me(e),{dimensionStyles:b}=Ae(e),{elevationClasses:P}=fe(e),{locationStyles:m}=Se(e),{positionClasses:E}=_e(e),{roundedClasses:w}=pe(e),{textColorClasses:y,textColorStyles:D}=be(()=>e.borderColor),{t:$}=ae(),A=B(()=>({"aria-label":$(e.closeLabel),onClick(s){v.value=!1,I("click:close",s)}}));return()=>{const s=!!(l.prepend||c.value),a=!!(l.title||e.title),n=!!(l.close||e.closable),O={density:e.density,icon:c.value,size:e.iconSize||e.prominent?u.value:void 0};return v.value&&o(e.tag,{class:U(["v-alert",e.border&&{"v-alert--border":!!e.border,[`v-alert--border-${e.border===!0?"start":e.border}`]:!0},{"v-alert--prominent":e.prominent},d.value,t.value,x.value,P.value,E.value,w.value,k.value,e.class]),style:j([f.value,b.value,m.value,e.style]),role:"alert"},{default:()=>[ke(!1,"v-alert"),e.border&&i("div",{key:"border",class:U(["v-alert__border",y.value]),style:j(D.value)},null),s&&i("div",{key:"prepend",class:"v-alert__prepend"},[l.prepend?o(Y,{key:"prepend-defaults",disabled:!c.value,defaults:{VIcon:{...O}}},l.prepend):o(K,h({key:"prepend-icon"},O),null)]),i("div",{class:"v-alert__content"},[a&&o(Ye,{key:"title"},{default:()=>[l.title?.()??e.title]}),l.text?.()??e.text,l.default?.()]),l.append&&i("div",{key:"append",class:"v-alert__append"},[l.append()]),n&&i("div",{key:"close",class:"v-alert__close"},[l.close?o(Y,{key:"close-defaults",defaults:{VBtn:{icon:e.closeIcon,size:"x-small",variant:"text"}}},{default:()=>[l.close?.({props:A.value})]}):o(Q,h({key:"close-btn",icon:e.closeIcon,size:"x-small",variant:"text"},A.value),null)])]})}}}),Ze=T({...Ge({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),H=F()({name:"VRadio",props:Ze(),setup(e,V){let{slots:I}=V;return X(()=>{const l=M.filterProps(e);return o(M,h(l,{class:["v-radio",e.class],style:e.style,type:"radio"}),I)}),{}}}),Ke=T({height:{type:[Number,String],default:"auto"},...Ce(),...se(Me(),["multiple"]),trueIcon:{type:G,default:"$radioOn"},falseIcon:{type:G,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),Qe=F()({name:"VRadioGroup",inheritAttrs:!1,props:Ke(),emits:{"update:modelValue":e=>!0},setup(e,V){let{attrs:I,slots:l}=V;const v=le(),c=N(()=>e.id||`radio-group-${v}`),u=Z(e,"modelValue"),d=g();return X(()=>{const[t,f]=oe(I),k=J.filterProps(e),x=M.filterProps(e),b=l.label?l.label({label:e.label,props:{for:c.value}}):e.label;return o(J,h({ref:d,class:["v-radio-group",e.class],style:e.style},t,k,{modelValue:u.value,"onUpdate:modelValue":P=>u.value=P,id:c.value}),{...l,default:P=>{let{id:m,messagesId:E,isDisabled:w,isReadonly:y}=P;return i(ne,null,[b&&o(Ee,{id:m.value},{default:()=>[b]}),o(Fe,h(x,{id:m.value,"aria-describedby":E.value,defaultsTarget:"VRadio",trueIcon:e.trueIcon,falseIcon:e.falseIcon,type:e.type,disabled:w.value,readonly:y.value,"aria-labelledby":b?m.value:void 0,multiple:!1},f,{modelValue:u.value,"onUpdate:modelValue":D=>u.value=D}),l)])}})}),je({},d)}}),Xe={class:"d-flex justify-space-between align-center mb-2"},ea={class:"d-flex justify-space-between align-center mb-4"},aa={class:"text-white font-weight-bold text-caption"},ta={key:0},la={key:1},oa={key:2},sa={key:3},na={class:"custom-loader"},ra={key:0},ua={key:1},ia=2e3,da={__name:"YTconverter",setup(e){const I=ue().public.apiBaseUrl,l=g(""),v=g("mp3"),c=g(""),u=g(""),d=g(null),t=g("IDLE"),f=g(0),k=g(null),{$curridataAPI:x}=ie(),b=N(function(){return t.value==="PENDING"||t.value==="DOWNLOADING"?"primary":t.value==="COMPLETED"?"success":t.value==="FAILED"||t.value==="ERROR"?"error":"grey"}),P=N(function(){return t.value==="PENDING"?"等待伺服器處理...":t.value==="DOWNLOADING"?`下載中... (${f.value.toFixed(1)}%)`:t.value==="COMPLETED"?"下載完成！":t.value==="FAILED"?"任務失敗！":t.value==="ERROR"?"連線/輪詢錯誤":"準備就緒"}),m=N(function(){return t.value==="PENDING"||t.value==="DOWNLOADING"}),E=async function(){if(c.value="",u.value="",y(),!l.value.trim()||!l.value.startsWith("http")){c.value="請輸入有效的 YouTube 網址，並確保它以 http 或 https 開頭。";return}t.value="PENDING",f.value=0,d.value=null,u.value="正在提交下載任務...";try{const s=JSON.stringify({url:l.value,format:v.value}),a=await x.post("submit_download_job",s),n=a.data;let O=n.job_id||n.id||n.taskId;if(!O)throw n.error||n.message?new Error(`伺服器回傳錯誤: ${n.error||n.message}`):new Error(`伺服器回傳格式錯誤，找不到 job_id、id 或 taskId。實際回傳資料：${JSON.stringify(a)}`);d.value=O,u.value=`任務已成功提交，Job ID: ${d.value}。開始追蹤進度...`,w()}catch(s){console.error("提交任務失敗:",s);let a=s.message||(typeof s=="object"&&s!==null?JSON.stringify(s):String(s));c.value=`提交任務失敗：${a}`,t.value="FAILED"}},w=function(){y(),D(),k.value=Ue(D,ia)},y=function(){k.value&&(clearInterval(k.value),k.value=null)},D=async function(){if(!d.value){y();return}try{const a=(await x.get(`download_status/${d.value}`)).data;if(!a.status)throw new Error("伺服器回傳狀態格式錯誤。");t.value=a.status,f.value=a.progress||0,t.value==="COMPLETED"?(y(),u.value="✅ 下載完成 (100%)！檔案已在伺服器準備完畢。正在啟動下載...",$()):t.value==="DOWNLOADING"?u.value=`下載中，進度更新至 ${f.value.toFixed(1)}%...`:t.value==="FAILED"&&(y(),c.value="❌ 任務處理失敗。請檢查網址或伺服器日誌。")}catch(s){console.error("輪詢錯誤:",s),y(),t.value="ERROR";let a=s.message||(typeof s=="object"&&s!==null?JSON.stringify(s):String(s));c.value=`輪詢狀態錯誤：${a}`}},$=function(){if(d.value&&t.value==="COMPLETED"){const s=`${I}/download_file/${d.value}`,a=document.createElement("a");a.href=s,a.setAttribute("download",`media_download_${d.value}.${v.value}`),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),u.value="🎉 檔案下載已開始。瀏覽器將提示您儲存位置。",setTimeout(function(){t.value="IDLE",f.value=0,d.value=null},3e3)}},A=function(){(t.value==="IDLE"||t.value==="FAILED"||t.value==="ERROR")&&E()};return(s,a)=>(p(),R(de,null,{default:r(()=>[o(Pe,{fluid:""},{default:r(()=>[o(we,{justify:"center",align:"start"},{default:r(()=>[o(Oe,{cols:"12",sm:"10",md:"8",lg:"6",xl:"5"},{default:r(()=>[o(W,{class:"pa-4 pa-sm-8",elevation:"12",rounded:"xl"},{default:r(()=>[o(Re,{class:"text-h4 text-sm-h3 text-center font-weight-bold mb-4"},{default:r(()=>[...a[5]||(a[5]=[S(" YouTube下載器 ",-1)])]),_:1}),o(Le,{class:"text-center mb-6"},{default:r(()=>[...a[6]||(a[6]=[i("p",null,"輸入 YouTube 網址，選擇格式，伺服器將在背景處理任務。",-1),i("p",null,"例如：https://www.youtube.com/watch?v=JfYbYIv2-tY",-1)])]),_:1}),c.value?(p(),R(z,{key:0,type:"error",closable:"",icon:"mdi-alert-circle",variant:"tonal",class:"mb-4","onUpdate:modelValue":a[0]||(a[0]=n=>c.value="")},{default:r(()=>[a[7]||(a[7]=i("div",{class:"font-weight-medium"},"錯誤:",-1)),S(" "+_(c.value),1)]),_:1})):L("",!0),u.value&&t.value!=="COMPLETED"?(p(),R(z,{key:1,type:"info",icon:"mdi-information-outline",variant:"tonal",class:"mb-4"},{default:r(()=>[a[8]||(a[8]=i("div",{class:"font-weight-medium"},"狀態:",-1)),S(" "+_(u.value),1)]),_:1})):L("",!0),t.value==="COMPLETED"?(p(),R(z,{key:2,type:"success",icon:"mdi-check-all",variant:"tonal",class:"mb-4","onUpdate:modelValue":a[1]||(a[1]=n=>u.value="")},{default:r(()=>[a[9]||(a[9]=i("div",{class:"font-weight-medium"},"下載已完成!",-1)),S(" "+_(u.value),1)]),_:1})):L("",!0),o(Be,{modelValue:l.value,"onUpdate:modelValue":a[2]||(a[2]=n=>l.value=n),label:"YouTube 影片網址",placeholder:"例如: https://www.youtube.com/watch?v=...",variant:"outlined",disabled:m.value,rules:[n=>!!n||"網址不能為空"],"prepend-inner-icon":"mdi-link-variant",clearable:"",class:"mb-6"},null,8,["modelValue","disabled","rules"]),o(Qe,{modelValue:v.value,"onUpdate:modelValue":a[3]||(a[3]=n=>v.value=n),label:"選擇輸出格式",inline:"",disabled:m.value,class:"mb-8"},{default:r(()=>[o(H,{label:"MP3 (音訊)",value:"mp3",color:"primary",icon:"mdi-music-box",class:"mr-4"}),o(H,{label:"MP4 (影片)",value:"mp4",color:"primary",icon:"mdi-video",class:"mr-4"})]),_:1},8,["modelValue","disabled"]),d.value?(p(),R(W,{key:3,loading:m.value,color:b.value,variant:"tonal",class:"mb-6 pa-4"},{default:r(()=>[i("div",Xe,[a[10]||(a[10]=i("span",{class:"text-subtitle-1 font-weight-medium"},"任務 ID:",-1)),o(q,{color:b.value,variant:"flat",size:"small"},{default:r(()=>[S(_(d.value),1)]),_:1},8,["color"])]),i("div",ea,[a[11]||(a[11]=i("span",{class:"text-subtitle-1 font-weight-medium"},"目前狀態:",-1)),o(q,{color:b.value,variant:"outlined",size:"default"},{default:r(()=>[S(_(P.value),1)]),_:1},8,["color"])]),o(Ne,{modelValue:f.value,"onUpdate:modelValue":a[4]||(a[4]=n=>f.value=n),color:b.value,height:"16",rounded:"",striped:"",class:"my-2"},{default:r(({value:n})=>[i("span",aa,_(n.toFixed(1))+"% ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["loading","color"])):L("",!0),o(Q,{onClick:A,loading:m.value,disabled:m.value,color:m.value?"primary":"success",size:"x-large",block:"",elevation:"8",rounded:"lg",class:"text-button"},{loader:r(()=>[i("span",na,[o(K,{icon:"mdi-cached",class:"spin-icon"}),a[12]||(a[12]=S(" 處理中... ",-1))])]),default:r(()=>[t.value==="IDLE"||t.value==="FAILED"||t.value==="ERROR"?(p(),C("span",ta,"開始下載")):t.value==="COMPLETED"?(p(),C("span",la,"下載完成 (點擊即可重新提交)")):t.value==="PENDING"?(p(),C("span",oa,"提交中...")):t.value==="DOWNLOADING"?(p(),C("span",sa,_(P.value),1)):L("",!0)]),_:1},8,["loading","disabled","color"]),o(he,{class:"text-caption text-center mt-6 text-grey-darken-1"},{default:r(()=>[a[13]||(a[13]=S(" **備註:** ",-1)),m.value?(p(),C("span",ra,"伺服器正在背景處理您的請求。請不要關閉頁面。")):(p(),C("span",ua,"下載時間取決於伺服器處理速度與檔案大小。"))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}},ga=re(da,[["__scopeId","data-v-5ab031ce"]]);export{ga as default};
